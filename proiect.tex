\documentclass[12pt, a4paper]{article}

\usepackage{float}
\restylefloat{table}
\usepackage{parskip}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{listings}
\usepackage{ragged2e}
\graphicspath{{./images/}}

\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{color}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{HTML}{052bb5}
\definecolor{backcolour}{HTML}{F2F2F2}
\definecolor{bookColor}{cmyk}{0,0,0,0.90}  
\color{bookColor}

\lstset{upquote=true,
        frame=single,
        postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}  
}

\lstdefinestyle{sql_code_style}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{codepurple},
    numberstyle=\numberstyle,
    stringstyle=\color{codepurple},
    basicstyle=\scriptsize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
}
\lstset{style=sql_code_style}

\newcommand\numberstyle[1]{%
    \scriptsize
    \color{codegray}%
    \ttfamily
    \ifnum#1<10 0\fi#1 |%
}

\title{Proiect Baze de Date}
\author{George Radu}
\date{}

\begin{document}
\maketitle

\section{Introducere - ex1}
\quad \par
Detaliile din acest proiect se referă la proiectarea unui model de date ce furnizează informații despre gestiunea companiilor de transporturi rutiere de mărfuri din România.

Modelul de date va gestiona informații legate de transporturile de mărfuri ale unor companii client de un depozit la altul. Există firme de pază care se ocupă de paza depozitelor. O firmă de pază alocă fiecărui depozit o echipă de pază.

Transporturile de marfă sunt realizate de o firmă de transport prin intermediul angajaților profesioniști care pot avea mai multe categorii de permise și se pot opri la mai multe popasuri petru odihnă/masă/alimentare. Transportul de marfă începe de la un depozit și se termină la alt depozit, în fiecare depozit accesul camionului este permis dupa o verificare a echipei de pază.

\section{Restricții de funcționare - ex2}
\quad \par
Modelul de date respectă anumite restricții de funcționare.
\begin{itemize}
    \item Orice depozit are un singur deținător(o companie client ori o firmă de transport) și poate fi folosit pentru depozitarea de mărfuri.
    \item O companie client sau o firmă de transport poate deține mai multe depozite.
    \item Unui depozit îi este alocată o unică locație.
    \item Un depozit este păzit la un moment dat de o singură echipă de pază.
    \item Un depozit are o listă de inventar cu ce mărfuri au intrat/ieșit împreună cu data și ora.
    \item Un lot de marfă poate să fie transportat de mai multe ori, nu neapărat î1 același transport, și nu neapărat între aceleași depozite.
    \item O echipă de pază aparține unei firme de pază, firmă de pază care poate avea mai multe echipe de pază, o firmă putând astfel să păzească mai multe depozite aflate în diferite locații.
    \item Un angajat poate să fie ori paznic ori șofer.
    \item Un transport de marfă se realizează prin intermediul unui camion \\încărcat cu marfă de la un depozit la altul.
    \item Un șofer poate să oprească în timpul transportului la mai multe popasuri pentru odihnă/mâncare sau alimentare. La popasuri pot veni mai mulți șoferi.
    \item Un popas se află intr-o unică locație și poate fi o benzinărie, un motel sau un restaurant. Nu ne interesează detalii specifice despre un popas cum ar fi ce mâncare vinde un restaurant, sau cât costa o cameră la un motel.
    \item Un șofer poate să aibă mai multe permise pentru mai multe categorii, poate chiar să i se anuleze/expire un permis și să trebuiască să îl obțină din nou.
    \item Un șofer trebuie să conducă un camion, dar poate să conducă mai multe camioane(nu în același timp) în funcție de problemele tehnice legate de camion și necesitățile firmei.
    \item O firmă de transport deține mai multe camioane, iar un camion este deținut de o singură firmă de transport.
    \item Transportul de marfă se face între 2 depozite, se transportă mai multe loturi de marfă. Pentru un transport vom reține și data din momentul în care a început transportul. Pentru fiecare transport se va folosi un singur camion condus de un șofer profesionist.
\end{itemize}

\newpage
\section{Entități - ex3}
\quad \par
Pentru modelul de date referitor la gestiunea companiilor de transporturi rutiere de mărfuri, structurile: DEPOZIT, LOCATIE, POPAS, FIRMA, CLIENT, PAZA, TRANSPORT, ECHIPA\_PAZA, INVENTAR\_DEPOZIT, INVENTAR\_TRANSPORT, LOT\_MARFA, CAMION, ANGAJAT,\\ PAZNIC, SOFER, PERMIS reprezintă entități.

Vom prezenta entitățile modelului de date, realizând o descriere completă a fiecăreia. De asemnea, pentru fiecare entitate se va preciza cheia primară.

Toate entitățile care vor fi precizate sunt independente, cu excepția\\ entităților dependente ECHIPA\_PAZA, PERMIS și\\ INVENTAR\_TRANSPORT
și a subentităților SOFER, PAZNIC, CLIENT, PAZA, TRANSPORT.

\begin{itemize}
    \item DEPOZIT = entitatea descrie o construcție al cărei proprietar este o firmă client sau de transport, în care pot fi depozitate mărfuri. Cheia primară a entității este id\_depozit.
    \item LOCATIE = entitatea descrie informații despre locația fizică a unei construcții, fie ea depozit sau popas. Cheia primară a entității este id\_locatie.
    \item POPAS = reprezintă un loc în care un șofer se poate opri pentru odihnă. Cheia primară a entității este id\_popas.
    \item FIRMA = entitatea descrie o persoană juridică din România, supraentitate pentru CLIENT, PAZA și TRANSPORT. Cheia primară a entității este id\_firma.
    \item CLIENT = persoană juridică beneficiară a unor servicii de transport oferite de o firmă de transport specializată. Cheia primară a entității este id\_firma.
    \item PAZA = persoana juridică ce asigură securitatea depozitelor prin intermediul unor echipe de pază formate din paznici profesioniști. Cheia primară a entității este id\_firma\_paza.
    \item TRANSPORT = persoană juridică responsabilă de transportul de\\ mărfuri în siguranță pentru companii client de la un depozit la altul. Pentru transporturi firma pune la dispoziție șoferilor săi mai multe camioane. Cheia primară a entității este id\_firma\_transport.
    \item ECHIPA\_PAZA = entitatea descrie informații despre o echipă formată din paznici responsabili de securitatea unui depozit. Cheia primară a entității este id\_echipa\_paza.
    \item INVENTAR\_DEPOZIT = entitatea descrie informații despre inventarierea unui depozit, ce loturi au intrat în inventariere, când au intrat și când au ieșit. Cheia primară a entității este id\_inventar\_depozit.
    \item INVENTAR\_TRANSPORT = entitatea descrie informații despre ce lot de marfă a fost implicat intr-un transport între 2 depozite. Cheia primară a entității este cheia compusa dintre id\_inventar\_transport și id\_lot\_marfa.
    \item LOT\_MARFA = entitatea descrie informații despre un lot de marfă transportată sau depozitată. Cheia primară a entității este id\_marfa.
    \item CAMION = vehicul de mare tonaj pentru transport marfă. Cheia primară a entității este id\_camion.
    \item ANGAJAT = persoană fizică angajată a unei companii fie de pază fie de transport pentru a-și oferi serviciile în schimbul unei remunerații. Cheia primară a entității este id\_angajat.
    \item PAZNIC = subentitate a entității ANGAJAT, lucrează pentru o companie de pază și este responsabil de securitatea unui depozit din cadrul echipei sale. Cheia primară a entității este id\_angajat.
    \item SOFER = subentitate a entității ANGAJAT, lucrează pentru o firmă de transport, îi este alocat un camion și este responsabil pentru transportul in siguranță a unei remorci cu marfă. Cheia primară a entității este id\_angajat.
    \item PERMIS = entitate ce descrie informații despre ce tipuri de permis are un șofer și când le-a obținut. Cheia primară a entității este una compusă din id\_permis + id\_angajat.
\end{itemize}

\newpage
\section{Relații - ex4}
\quad\newline
Se vor prezenta relațiile modelului de date, dând o descriere completă a fiecăreia. Denumirile acestor legături între entități sunt alese sugestiv. Pentru fiecare relație se va preciza cardinalitatea minimă și maximă.
\begin{itemize}
    \item DEPOZIT\_se\_află\_LOCATIE = relație ce leagă entitățile DEPOZIT și LOCATIE, reflectând legătura dintre acestea(un depozit se află plasat într-o locație unică din țară). Ținând cont de condițiile impuse modelului un depozit trebuie să se afle într-o singură locație. Relația are cardinalitatea minimă 1:1 și cardinalitatea maximă 1:1.
    \item POPAS\_se\_află\_LOCATIE = relație ce leagă entitățile POPAS și  LOCATIE, reflectând legătura dintre acestea(un popas se află plasat într-o locație unică din țară). Ținând cont de condițiile impuse modelului un popas trebuie să se afle într-o singură locație. Relația are cardinalitatea minimă 1:1 și cardinalitatea maximă 1:1.
    \item FIRMA\_detine\_DEPOZIT = relație ce leagă entitățile FIRMA și DEPOZIT, reflectând legătura dintre acestea(un depozit este deținut de o firmă). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:M.
    \item PAZA\_aparține\_ECHIPA\_PAZA = relație ce leagă entitățile PAZA și ECHIPA\_PAZA, reflectând legătura dintre acestea(o echipă de pază aparține unei firme de pază). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:M.
    \item ECHIPA\_PAZA\_păzește\_DEPOZIT = relație ce leagă entitățile \\ECHIPA\_PAZA și DEPOZIT, reflectând legătura dintre acestea (o echipă de pază trebuie să păzească un depozit pentru a permite accesuri în depozit doar de staff autorizat). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:1(Conform condițiilor impuse modelului un depozit va fi păzit la un moment în timp doar de o echipă de pază).
    \item PAZNIC\_aparține\_ECHIPA\_PAZA = relație ce leagă entitățile PAZNIC și ECHIPA\_PAZA, reflectând legătura dintre acestea (un paznic trebuie să facă parte dintr-o echipă de pază trimisă la un depozit, paznicul lucrează pentru firmă de pază de care aparține echipa). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă M:1(un paznic face parte dintr-o singură echipă, iar o echipă este formată din mai mulți paznici).
    \item INVENTAR\_DEPOZIT\_aparține\_DEPOZIT = relație ce leagă entită-țile INVENTAR\_DEPOZIT și DEPOZIT, reflectând legătura dintre acestea (un depozit trebuie să țină inventarul la ce loturi de marfă intră și iese și când s-au întâmplat aceste evenimente). Relația are cardinalitatea minimă 0:1 si cardinalitatea maximă M:1(inițial un depozit abia construit poate să nu conțină niciun record de invetariere, urmând pe parcurs să aibă).
    \item INVENTAR\_DEPOZIT\_aparține\_LOT\_MARFA = relație ce leagă entitățile INVENTAR\_DEPOZIT și LOT\_MARFA , reflectând legătura dintre acestea(un lot de marfă va fi înregistrat în lista de inventar a unui depozit atunci când va fi adus în depozit fizic). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă M:1(Același lot de marfă poate să fie transferat între depozite din puncte cheie din țarâ în funcție de necesitățile firmei client).
    \item LOT\_MARFA\_aparține\_INVENTAR\_TRANSPORT = relație ce leagă entitățile LOT\_MARFA și INVENTAR\_TRANSPORT, reflectând \\legătura dintre acestea (pentru fiecare transport de marfă se face un inventar din care fac parte mai multe loturi de marfă, un lot de marfă poate să fie transportat de mai multe ori). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:M(ținând cont de condițiile impuse modelului entitatea INVENTAR\_TRANSPORT va conține doar un lot de marfă și din ce lot face parte).
    \item CAMION\_transportă\_INVENTAR\_MARFĂ\_de\_la\_DEPOZIT\\\_la\_DEPOZIT = relație de tip 3 leagă entitățile DEPOZIT, DEPOZIT, INVENTAR\_MARFĂ și CAMION, reflectând ce marfă a fost transportată de la un depozit de plecare la unul de sosire, transportul fiind făcut cu un camion. Denumirea acestei relații va fi transport.
    \item TRANSPORT\_detine\_CAMION = relație ce leagă entitățile TRANSPORT și CAMION, reflectând legătura dintre acestea(o firmă de transport trebuie să dețină camioane). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:M.
    \item SOFER\_conduce\_CAMION = relație ce leagă entitățile SOFER și \\CAMION, reflectând legătura dintre acestea(un șofer de la o firmă de transport trebuie să conducă cel puțin un camion pentru a-și îndeplini saricinile de la muncă). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă M:M.
    \item ANGAJAT\_lucrează\_la\_FIRMA = relație ce leagă entitățile ANGAJAT și FIRMA, reflectând legătura dintre acestea(un anagajt/o persoană fizică este angajat/ă la o firmă, acesta își oferă serviciile în schimbul unei remunerații). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă M:1.
    \item SOFER\_detine\_PERMIS = relație ce leagă entitățile SOFER și PERMIS, reflectând legătura dintre acestea(un șofer pentru a se putea angaja are nevoie de un permis care să îi ofere dreptul de a conduce un camion, șoferul poate să aibă mai multe categorii de permise, în functie de necesitățile sale). Relația are cardinalitatea minimă 1:1 si cardinalitatea maximă 1:M.
    \item SOFER\_istoric\_popasuri\_POPAS = relație ce leagă entitățile SOFER și POPAS, reflectând legătura dintre acestea(un șofer nu poate să conducă mai mult de 8h conform legii, motiv pentru care trebuie să mai ia pauze de odihnă, pauze pe care le poate lua la un motel sau în parcarea unui restaurant sau benzinării de unde poate să și mănânce și să se întâlnească cu alți șoferi). Relația are cardinalitatea minimă 0:0 si cardinalitatea maximă M:M.

\end{itemize}

\section{Atribute - ex5}
\begin{itemize}
    \item Entitatea independentă LOCATIE are ca atribute:
        \begin{itemize}
            \item id\_locatie = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unei locații, reprezintă cheia primară.
            \item județ = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele județului.
            \item localitate = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele localității.
            \item stradă = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele străzii.
            \item nr = variabilă de tip întreg, de lungime maximă 5, care reprezintă numărul locației.
        \end{itemize}
    \item Entitatea independentă DEPOZIT are ca atribute:
        \begin{itemize}
            \item id\_depozit = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul unui depozit, reprezintă cheia primară.
            \item id\_locatie = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul locației pentru depozit. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul LOCATIE.
            \item id\_firma = variabilă de tip întreg, de lungime maximă 12, care reprezintă id-ul firmei care deține depozitul. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul FIRMA.
            \item id\_echipa\_paza = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul echipei de pază al depozitului. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul ECHIPA\_PAZA.
        \end{itemize}
    \item Entitatea independentă POPAS are ca atribute:
        \begin{itemize}
            \item id\_popas = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui popas, reprezintă cheia primară.
            \item id\_locatie = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul locației pentru popas. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul LOCATIE.
            \item nume = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele popasului.
            \item tip\_popas = variabilă de tip caracter, de lungime maximă 10. Atributul poate lua valorile: BENZINĂRIE, MOTEL, RESTAURANT; nu poate fi \emph{null}.
        \end{itemize}
    \item Entitatea independentă FIRMA are ca atribute:
        \begin{itemize}
            \item id\_firma = variabilă de tip întreg, de lungime maximă 12, care reprezintă id-ul firmei, reprezintă cheia primară.
            \item nume = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele firmei, numele unei firme este unic.
            \item tip\_firmă = variabilă de tip caracter, de lungime maximă 10, care poate lua valorile: CLIENT, PAZA, TRANSPORT; nu poate fi \emph{null}.
        \end{itemize}
    \item Entitatea ECHIPA\_PAZA are ca atribute:
        \begin{itemize}
            \item id\_echipa\_paza = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul unei echipe din cadrul firmei de pază, \\reprezintă cheia primară.
            \item id\_firma = variabilă de tip întreg, de lungime maximă 12, care reprezintă id-ul firmei de pază. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul PAZA.
        \end{itemize}
    \item Entitatea INVENTAR\_DEPOZIT are ca atribute:
        \begin{itemize}
            \item id\_inventar\_depozit = variabilă de tip întreg de lungime maximă 10, care reprezintă id-ul unei intrări de marfă în inventar, \\reprezintă cheia primară.
            \item id\_depozit = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul depozitul în care se află marfa. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul .
            \item id\_lot\_marfa = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul lotului de marfă care a intrat în inventar. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul LOT\_MARFA.
            \item data\_sosire = variabilă de tip data calendaristică, care reprezintă data la care a intrat marfa în inventariere; are valoarea default data în care se adaugă un nou element, i.e. \emph{sysdate}.
            \item ora\_sosire = variabilă de tip ora, care reprezintă ora la care a intrat marfa în inventarierea; are valoarea default ora la care s-a adăugat un nou element.
            \item data\_plecare = variabilă de tip data calendaristică, care reprezintă data la care a ieșit marfa din inventariere.
            \item ora\_plecare = variabilă de tip ora, care reprezintă ora la care a ieșit marfa din inventariere.
        \end{itemize}
    \item Entitatea LOT\_MARFA are ca atribute:
        \begin{itemize}
            \item id\_lot\_marfa = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui lot de marfă, reprezintă cheia primară.
            \item nume = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele mărfii din lot; nu poate fi \emph{null}.
            \item cantitate = variabilă de tip real, de lungime maximă 10, care reprezintă cantitatea lotului de marfă, nu poate fi \emph{null}.
        \end{itemize}
    \item Entitatea INVENTAR\_TRANSPORT are ca atribute:
        \begin{itemize}
            \item id\_inventar\_transport = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unei intrări de inventar al unui transport; face parte din cheia primară compusă.
            \item id\_lot\_marfa = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui lot de marfă care face parte din inventarul unui transport. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul LOT\_MARFA, face parte din cheia primară compusă.
            \item id\_transport = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul transportului din care face parte această listare. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul TRANSPORT.
        \end{itemize}
    \item Entitatea TRANSPORT are ca atribute:
        \begin{itemize}
            \item id\_transport = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui transport de marfă între 2 depozite, reprezintă cheia primară.
            \item depozit\_plecare = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul depozitului de unde începe transportul și este preluată marfa. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul DEPOZIT.
            \item depozit\_destinație = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul depozit unde este livrată marfa. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul DEPOZIT.
            \item id\_camion = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul camionului folosit pentru transport. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul CAMION.
            \item data\_plecare = variabilă de tip data calendaristică, care reprezintă data la care a plecat camionul din depozitul de plecare; are valoarea default data în care s-a adăugat un nou element, i.e. \emph{sysdate}.
            \item ora\_plecare = variabilă de tip ora, care reprezintă ora la care a plecat camionul din depozitul de plecare; are valoarea default ora la care s-a adăugat un nou transport.
        \end{itemize}
    \item Entitatea CAMION are ca atribute:
        \begin{itemize}
            \item id\_camion = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul unui camion, reprezintă cheia primară.
            \item id\_firma = variabilă de tip întreg, de lungime maximă 12, care reprezintă id-ul firmei de transport care deține camionul. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul TRANSPORT.
            \item marca = variabila de tip caracter, de lungime maxima 10, care reprezintă firma care a produs camionul.
            \item nr\_inmatriculare = variabila de tip caracter, de lungime maxima 10, reprezintă un identificator unic pentru autovehicule. Acest atribut poate fi schimbat (de obicei cand se se schimba detinatorul) motiv pentru care nu reprezintă parte din cheia primară.
        \end{itemize}
    \item Entitatea ANGAJAT are ca atribute:
        \begin{itemize}
            \item id\_angajat = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui angajat, reprezintă cheia primară.
            \item nume = variabilă de tip caracter, de lungime maximă 25, care reprezintă numele unui angajat.
            \item prenume = variabilă de tip caracter, de lungime maximă 25, care reprezintă prenumele unui angajat.
            \item nr\_telefon = variabilă de tip caracter, de lungime maximă 14, care reprezintă numărul de telefon al unui angajat.
            \item data\_angajare = variabilă de tip data calendaristică, care \\reprezintă data în care a fost angajat o persoană; are valoarea default data în care a fost adăugat un angajat în baza de date, i.e. \emph{sysdate}.
            \item salariu = variabilă de tip real, de lungime maximă 10, care repre-zintă salariul anagajatului.
            \item id\_firma = variabile de tip întreg, de lungime maximă 12, care reprezintă id-ul firmei la care lucrează angajatul. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul FIRMA.
            \item tip\_angajat = variabilă de tip caracter, de lungime maximă 6, care reprezintă tipul angajatului. Poate să fie PAZNIC sau SOFER.
        \end{itemize}
    \item Entitatea PAZNIC are aceleași atribute ca supraentitatea din care face parte + atributul id\_echipa\_paza (= variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul echipei de pază din care face parte paznicul. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul ECHIPA\_PAZA).
    \item Entitatea SOFER are aceleași atribute ca supraentitatea din care face parte. Nu are alte atribute adiționale.
    \item Entitatea ISTORIC\_CAMIOANE\_CONDUSE are ca atribute:
        \begin{itemize}
            \item id\_istoric\_camioane\_conduse = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unei intrări în istoric, reprezintă cheia primară.
            \item id\_angajat = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui șofer. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul SOFER.
            \item id\_camion = variabilă de tip întreg, de lungime maximă 5, care reprezintă id-ul camionului condus. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul CAMION; are valoarea default data în care s-a adăugat un element, i.e. \emph{sysdate}.
            \item data\_inceput = variabilă de tip data calendaristică, care reprezintă data la care a început un șofer să conducă un camion al firmei de transport.
            \item data\_sfarsit = variabilă de tip data calendaristică, care reprezintă data la care un șofer nu mai conduce un camion.
        \end{itemize}
    \item Entitatea PERMIS are ca atribute:
        \begin{itemize}
            \item id\_permis = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui permis; face parte din cheia primară compusă.
            \item id\_angajat = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui angajat care deține un permis. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul SOFER, face parte din cheia primară compusă.
            \item categorie = variabilă de tip caracter, de lungime maximă 3, care reprezintă tipul de permis care poate fi deținut de o persoană. Atributul poate lua valorile AM, A1, A2, A, B1, B, BE, C1, C1E, C, CE, D1, D1E, D, DE, Tr, Tb sau Tv.
            \item data = variabilă de tip data calendaristică, care reprezintă data la care a fost emis permisul pentru o persoană; are ca valoare default data în care a fost introdus un element în baza de date, i.e. \emph{sysdate}.
            \item ora = variabilă de tip ora, care reprezintă ora la care a fost emis permisul pentru o persoană; are ca valoare default ora la care a fost introdu un element în baza de date.
        \end{itemize}
    \item Entitatea ISTORIC\_POPASURI are ca atribute:
        \begin{itemize}
            \item id\_istoric\_popas = variabilă de tip întreg, de lungime maximă 20, care reprezintă id-ul unui istoric în popas; face parte din cheia primară compusă.
            \item id\_popas = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui popas la care s-a oprit un șofer. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul POPAS; face parte din cheia primară compusă.
            \item id\_angajat = variabilă de tip întreg, de lungime maximă 10, care reprezintă id-ul unui șofer care s-a oprit la un popas. Atributul trebuie să corespundă la o valoare a cheii primare din tabelul SOFER; face parte din cheia primară compusă.
            \item data\_sosire = variabilă de tip data calendaristică, care reprezintă data la care a ajuns un șofer la un popas; are ca valoare default data în care a fost introdus un element, i.e. \emph{sysdate}; face parte din cheia primară compusă.
            \item ora\_sosire = variabilă de tip ora, care reprezintă ora la care a ajuns un șofer la un popas; are ca valoare default ora la care a fostintrodus un element; face parte din cheia primară compusă.
            \item data\_plecare = variabilă de tip data calendaristică, care reprezintă data la care a plecat un șofer de la un popas; are ca valoare default data la care a fost introdus un element, se consideră ca majoritatea opririlor sunt de durată scurtă/medie și cazurile în care o oprire se lungește pe $>=$2 zile fiind rare.
            \item ora\_plecare = variabilă de tip ora, care reprezintă ora la care a plecat un șofer de la un popas; analog data\_plecare.
        \end{itemize}
\end{itemize}

    Mai sunt de prezentat următoarele relații m:m care se vor transforma in tabele asociative in implementare:
\begin{itemize}
    \item Relația CAMION\_transportă\_INVENTAR\_MARFĂ\_de\_la\_DEPOZIT\\\_la\_DEPOZIT are ca atribute: id\_transport, depozit\_plecare,\\ depozit\_destinație, camion, data\_plecare, ora\_plecare.
    \item Relația SOFER\_conduce\_CAMION are ca atribute: \\id\_istoric\_camioane\_conduse, id\_angajat, id\_camion, data\_inceput,\\ data\_sfarsit.
    \item Relația SOFER\_istoric\_popasuri\_POPAS are ca atribute: \\id\_istoric\_popas, id\_popas, id\_angajat, data\_sosire, ora\_sosire,\\ data\_plecare, ora\_plecare.
\end{itemize}

\newpage
\section{Diagrama entitate-relație E/R - ex6}
\includegraphics[width=\textwidth]{_diagrama_er.png}
\label{Figura 1}
\centering Figura 1

\justify

\section{Diagrama conceptuală - ex7}
\includegraphics[width=\textwidth]{_diagrama_conceptuala.png}
\label{Figura 2}
\centering Figura 2

\justify

\section{Schemele relaționale - ex8}
\quad \par
Schemele relaționale corespunzătoare diagramei conceptuale din Figura 2 sunt următoarele:
\begin{itemize}
    \item DEPOZIT(id\_depozit\#, id\_locatie, id\_echipa\_paza, id\_firma)
    \item LOCATIE(id\_locatie\#, județ, localitate, stradă, nr)
    \item POPAS(id\_popas\#, id\_locatie, nume, tip\_popas)
    \item FIRMA(id\_firma\#, nume, tip\_firmă)
    \item CLIENT(id\_firma\#)
    \item PAZA(id\_firma\#)
    \item TRANSPORT(id\_firma\#)
    \item ECHIPA\_PAZA(id\_echipa\_paza\#, id\_firma\_paza)
    \item INVENTAR\_DEPOZIT(id\_inventar\_depozit\#, id\_depozit, \\id\_lot\_marfa, data\_sosire, ora\_sosire, data\_plecare, ora\_plecare)
    \item INVENTAR\_TRANSPORT(id\_inventar\_transport\#, id\_marfa\#,\\ id\_transport)
    \item LOT\_MARFA(id\_lot\_marfa\#, nume, cantitate)
    \item CAMION(id\_camion\#, id\_firma, marca, nr\_inmatriculare)
    \item TRANSPORT(id\_transport\#, depozit\_plecare, depozit\_destinație,\\ id\_camion, data\_plecare, ora\_plecare)
    \item ANGAJAT(id\_angajat\#, nume, prenume, nr\_telefon, data\_angajare, salariu, id\_firma, tip\_angajat)
    \item PAZNIC(id\_angajat\#, id\_echipa\_paza)
    \item SOFER(id\_angajat\#)
    \item PERMIS(id\_permis\#, id\_angajat\#, categorie, data, ora)
    \item ISTORIC\_CAMIOANE\_CONDUSE(id\_istoric\_camioane\_conduse\#,\\ id\_angajat, id\_camion, data\_inceput, data\_sfarsit)
    \item ISTORIC\_POPASURI(id\_istoric\_popas\#, id\_popas\#, id\_angajat\#,\\ data\_sosire\#, ora\_sosire\#, data\_plecare, ora\_plecare)
\end{itemize}

\section{Forme normale - ex 9 + 18}

\subsection*{Forma normala 1 - exemplu 1}
Se dă relația \emph{SOFER\_detine\_PERMIS} în care un șofer poate deține mai multe permise. S-a plecat de relația de tipul(obs. nu sunt trecute toate atributele unui angajat, doar câteva pentru a nu mări tabelul și a face toate datele cât mai lizibile și clare):

\begin{table}[!htbp]
\caption{Relația nu e în FN1}\label{tab1}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_angajat\# & nume & prenume & .. & tip\_angajat & id\_permis\# & categorie & data & ora \\
\hline
20000 & Ion & Vasile  & .. & SOFER & 1 & C, B, A & 06-06-2012, & 12$:$00, \\
 & & & & & & & 06-06-2013, & 12$:$00, \\
 & & & & & & & 06-06-2017 & 12$:$00 \\
\hline
20020 & Ovidie & Ion & .. & SOFER & 2 & C & 06-06-2018 & 12$:$00 \\
\hline
20100 & Constantin & Gheorghe & .. & SOFER & 3 & B, C & 06-06-2010, & 12$:$00, \\
 & & & & & & & 06-06-2012 & 12$:$00 \\
\hline
\end{tabular}}
\end{table}

în care se observă că atributelor \emph{categorie}, \emph{data} și \emph{ora} le corespund o listă de valori, i.e. nu le corespund o valoare indivizibilă(atomică), de unde se trage concluzia că relația \emph{SOFER\_detine\_PERMIS} nu se află în forma normala 1 (FN1). Se aduce relația în FN1 spărgând atributele nonatomice în atribute atomice, proces în care se adaugă mai multe linii pentru fiecare categorie de permis pentru un șofer după cum urmează:

\begin{table}[!htbp]
\caption{Transformarea în FN1}\label{tab2}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_angajat\# & nume & prenume & .. & tip\_angajat & id\_permis\# & categorie & data & ora \\
\hline
20000 & Ion & Vasile  & .. & SOFER & 1 & A & 06-06-2012 & 12$:$00 \\
\hline
20000 & Ion & Vasile  & .. & SOFER & 2 & B & 06-06-2013 & 12$:$00 \\
\hline
20000 & Ion & Vasile  & .. & SOFER & 3 & C & 06-06-2017 & 12$:$00 \\
\hline
20020 & Ovidie & Ion & .. & SOFER & 1 & C & 06-06-2018 & 12$:$00 \\
\hline
20100 & Constantin & Gheorghe & .. & SOFER & 1 & B & 06-06-2010 & 12$:$00 \\
\hline
20100 & Constantin & Gheorghe & .. & SOFER & 2 & C & 06-06-2012 & 12$:$00 \\
\hline
\end{tabular}}
\end{table}

\subsection*{Forma normala 2 - exemplu 1}
Pentru ca relația \emph{SOFER\_detine\_PERMIS} să fie în formă normală 2 (FN2) trebuie să fie mai întâi în FN1, lucru realizat anterior, și în plus trebuie să indeplinească condiția ca fiecare atribut care nu este cheie (nu participă la cheia primară) este \textbf{dependent de întreaga cheie primară}.

Relația de mai sus nu se află în FN2 întrucât se găsesc atributele \emph{nume, prenume, nr\_telefon, .., tip\_angajat} care nu sunt chei și trebuie să depindă direct de întreaga cheie primară \textbf{id\_angajat\#} și \textbf{id\_permis\#}. Atributele nu depind direct de întreaga cheie primară, deoarece se observă dependența directă dintre \emph{id\_angajat\#} și \emph{nume, prenume, .., tip\_angajat}, însemnând că \emph{nume, prenume, .., tip\_angajat} depind direct doar de o parte a cheii primare(i.e. \emph{id\_angajat\#} nu și de \emph{id\_permis\#}).

Aplicăm regula \emph{Casey-Delobel} pentru FN2:

Avem relația \emph{R(K1, K2, X, Y)}, unde \emph{K1=id\_angajat\#}, \emph{K2=id\_permis\#} care definesc cheia primară compusă, iar \emph{X} și \emph{Y} sunt mulțimi de atribute, astfel încât \emph{K1}$\rightarrow$\emph{X}, unde \emph{X}=\{\emph{nume, prenume, nr\_telefon, .., tip\_angajat}\} și \emph{Y}=\{\emph{categorie, data, ora}\}.

Din cauza dependenței funcționale \emph{K1}$\rightarrow$\emph{X} care arată că \emph{R} nu este în FN2, se înlocuiește R(\emph{fără pierdere de informație}) prin două proiecții: \emph(K1, K2, Y) și \emph(K1, X).

Astfel avem în final proiecțiile:

\begin{itemize}
    \item \{id\_angajat\#\} $\rightarrow$ \{nume, prenume, nr\_telefon, data\_angajare, id\_firma, nume\_firma, tip\_angajat\}, \emph{id\_angajat\#} determinând funcțional\\ atributele menționate anterior
    \item \{id\_permis\#, id\_angajat\#\} $\rightarrow$ \{categorie, data, ora\}
\end{itemize}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R1(K1, K2, Y)}}\label{tab3}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_angajat\# & id\_permis\# & categorie & data & ora \\
\hline
20000 & 1 & A & 06-06-2012 & 12$:$00 \\
\hline
20000 & 2 & B & 06-06-2013 & 12$:$00 \\
\hline
20000 & 3 & C & 06-06-2017 & 12$:$00 \\
\hline
20020 & 1 & C & 06-06-2018 & 12$:$00 \\
\hline
20100 & 2 & B & 06-06-2010 & 12$:$00 \\
\hline
20100 & 1 & C & 06-06-2012 & 12$:$00 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R2(K1, X)}}\label{tab4}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l |}
\hline
id\_angajat\# & nume & prenume & .. & tip\_angajat \\
\hline
20000 & Ion & Vasile  & .. & SOFER \\
\hline
20020 & Ovidie & Ion & .. & SOFER \\
\hline
20100 & Constantin & Gheorghe & .. & SOFER \\
\hline
\end{tabular}}
\end{center}
\end{table}

\subsection*{Forma normala 3 - exemplu 1}
Pentru ca relația \emph{SOFER\_detine\_PERMIS} să fie în formă normală 3 (FN3) trebuie să fie mai întâi în FN2, lucru realizat anterior, și în plus trebuie să îndeplinească condiția ca fiecare atribut care nu este cheie(nu participă la o cheie) \textbf{să depindă direct de cheia primară}.

În proiecția \emph{R1(K1, K2, Y)} toate atributele depind direct de cheia primară. \emph{Categoria} reprezintă tipul de autovehicul pe care permisul îi oferă dreptului unui șofer care l-a obținut să conducă autovehicule de categoria respectivă. Data și ora reprezintă când a fost obținut permisul de o persoană(de acum supranumită șofer). Pentru această relație nu există dependențe tranzitive, de unde rezultă că se află în FN3. Se va denumi această relație \emph{SOFER\_detine\_PERMIS}.

Se verifică acum relația \emph{R2(K1, X)}.

\begin{table}[!htbp]
\begin{center}
\caption{Relația \emph{R2(K1, X)}}\label{tab5}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_angajat\# & nume & prenume & nr\_telefon & .. & id\_firma & nume & tip\_firma & tip\_angajat \\
\hline
20000 & Ion & Vasile & 0722123456 & .. & 1100 & Road Logistics & TRANSPORT & SOFER \\
\hline
20020 & Ovidie & Ion & 0727124356 & .. & 1100 & Road Logistics & TRANSPORT & SOFER \\
\hline
20100 & Constantin & Gheorghe & 0735123456 & .. & 1400 & Lextom Trans Asd & TRANSPORT & SOFER \\
\hline
\end{tabular}}
\end{center}
\end{table}

Relația R2 este în FN2 după cum a fost demonstrat anterior, însă nu se află în FN3 întrucât se obvservă că atributele \emph{nume(firmă), tip\_firmă} depind tranzitiv de cheia primară \emph{id\_angajat} prin intermediul atributului \emph{id\_firma}.

Pentru a reduce relația în FN3 se aplică regula \emph{Casey-Delobel}. Relația se descompune, prin eliminarea dependențelor funcționale tranzitive, în \\proiecții.

Avem relația \emph{R(K, $X_1$, $X_2$, $X_3$)}, unde $X_2$=\{\emph{nume(firma), tip\_firma}\} depinde tranzitiv de \emph{K}=\emph{id\_angajat\#}(i.e. cheia primară a lui \emph{R}). Se presupune că $K\rightarrow X_1\rightarrow X_2$. ($X_1$=id\_firma si $X_3$=\{nume, prenume, nr\_telefon, ..\})

Din cauza dependenței funcționale $X_1\rightarrow X_2$ care arată că $R$ nu este în FN3, se înlocuiește $R$ (\textbf{fără pierdere de informație}) prin două proiecții $R1(K, X_1, X_3)$ și $R2(X_1, X_2)$.

\begin{itemize}
    \item \{id\_angajat\#\} $\rightarrow$ \{nume, prenume, nr\_telefon, data\_angajare, salariu, id\_firma, tip\_angajat\}
    \item \{id\_firma\#\} $\rightarrow$ \{nume, tip\_firma\}
\end{itemize}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R2-1(K, $X_1$, $X_3$)}}\label{tab6}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_angajat\# & nume & prenume & nr\_telefon & .. & id\_firma & tip\_angajat \\
\hline
20000 & Ion & Vasile & 0722123456 & .. & 1100 & SOFER \\
\hline
20020 & Ovidie & Ion & 0727124356 & .. & 1100 & SOFER \\
\hline
20100 & Constantin & Gheorghe & 0735123456 & .. & 1400 & SOFER \\
\hline
\end{tabular}}
\end{center}
\end{table}
\quad \par

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R2-2($K_1$, $K_2$)}}\label{tab7}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_firma\# & nume & tip\_firma \\
\hline
1100 & Road Logistics & TRANSPORT \\
\hline
1100 & Road Logistics & TRANSPORT \\
\hline
1400 & Lextom Trans Asd & TRANSPORT \\
\hline
\end{tabular}}
\end{center}
\end{table}
\quad \par

\setlength\parskip{\baselineskip}

\subsection*{Forma normala 1 - exemplu 2}
Se dă relația \emph{CAMION\_transportă\_INVENTAR\_MARFĂ\_de\_la\_\\DEPOZIT\_la\_DEPOZIT} în care prin intermediul unui camion este transportată marfă, marfă pentru care se face o inventariere a transportului de la un depozit la altul. Se pleacă de la prima variantă a relației:

\begin{table}[!htbp]
\begin{center}
\caption{Relația nu e în FN1}\label{tab8-1}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_         & depozit\_ &  id\_    & id\_  & id\_echipa & depozit\_    & id\_    & id\_  & id\_echipa \\
transport\#  & plecare\# &  locatie & firma & \_paza     & destinatie\# & locatie & firma & \_paza     \\
\hline
10000        & 3000      & 100      & 4     & 1100       & 500        & 30      & 2     & 100 \\
\hline
10010        & 3000      & 100      & 4     & 1100       & 500        & 30      & 2     & 100 \\
\hline
10020        & 3500      & 120      & 10    & 1200       & 1000       & 50      & 3     & 200 \\
\hline
\end{tabular}}
\end{center}
\begin{center}
\label{tab8-2}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_     & id\_  & marca & nr\_          & id\_inventar  & id\_lot   & nume & cantitate & data\_  & ora\_   \\
camion\# & firma &       & inmatriculare & \_transport\# & \_marfa\# &      &           & plecare & plecare \\
\hline
15     & 1100  & VOLVO & CT12FSD       & 100           & 100     & carne miel & 100 & 6-05-2021 & 08$:$00 \\
     &   &  &        & 155           & 105     & carne porc & 300 & &  \\
\hline
25     & 1100  & VOLVO & CT90MMM       & 210           & 110     & carne pui & 250 & 8-05-2021 & 06$:$00 \\
\hline
35     & 1200  & SCANIA & PH13SCN      & 265           & 120     & rosii & 1000 & 6-05-2021 & 08$:$00 \\
\hline
\end{tabular}}
\end{center}
\end{table}

în care se observă că atributelor \emph{id\_inventar\_transport, id\_lot\_marfa,\\ nume(marfa), cantitate} le corespund o listă de valori, i.e. nu le corespund o valoare indivizibilă(atomică), de unde se trage concluzia că relația \emph{CAMION\_\\transportă\_INVENTAR\_MARFĂ\_de\_la\_DEPOZIT\_la\_DEPOZIT} nu se află în forma normală 1 (FN1). Se aduce relația în FN1 spărgând atributele \\nonatomice în atribute atomice, proces în care se adaugă mai multe linii pentru fiecare lot de marfă transportat și detaliile sale după cum urmează:

\begin{table}[H]
\begin{center}
\caption{Transformarea în FN1}\label{tab9-1}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_         & depozit\_ &  id\_        & id\_      & id\_echipa     & depozit\_    & id\_        & id\_      & id\_echipa \\
transport\#  & plecare\# &  locatie(dp) & firma(dp) & \_paza(dp)     & destinatie\# & locatie(dd) & firma(dd) & \_paza(dd)  \\
\hline
10000        & 3000      & 100      & 4     & 1100       & 500        & 30      & 2     & 100 \\
\hline
10000        & 3000      & 100      & 4     & 1100       & 500        & 30      & 2     & 100 \\
\hline
10010        & 3000      & 100      & 4     & 1100       & 500        & 30      & 2     & 100 \\
\hline
10020        & 3500      & 120      & 10    & 1200       & 1000       & 50      & 3     & 200 \\
\hline
\end{tabular}}
\end{center}
\begin{center}
\label{tab9-2}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_     & id\_     & marca & nr\_          & id\_inventar  & id\_lot   & nume & cantitate & data\_  & ora\_   \\
camion\# & firma(c) &       & inmatriculare & \_transport\# & \_marfa\# &      &           & plecare & plecare \\
\hline
15     & 1100  & VOLVO & CT12FSD       & 100           & 100     & carne miel & 100 & 6-05-2021 & 08$:$00 \\
\hline
15     & 1100  & VOLVO & CT12FSD       & 155           & 105     & carne porc & 300 & 6-05-2021 & 08$:$00 \\
\hline
25     & 1100  & VOLVO & CT90MMM       & 210           & 110     & carne pui & 250 & 8-05-2021 & 06$:$00 \\
\hline
35     & 1200  & SCANIA & PH13SCN      & 265           & 120     & rosii & 1000 & 6-05-2021 & 08$:$00 \\
\hline
\end{tabular}}
\end{center}
\end{table}

Obs: Pentru atributele care se repetă s-a adăugat în paranteză la final un alias, a.î. să fie clar de care cheie depinde.

\subsection*{Forma normala 2 - exemplu 2}
Pentru ca relația \emph{CAMION\_transportă\_INVENTAR\_MARFĂ\_de\_la\_\\DEPOZIT\_la\_DEPOZIT} să fie în formă normală 2 (FN2) trebuie să fie mai întâi în FN1, lucru realizat anterior, și în plus trebuie să indeplinească condiția ca fiecare atribut care nu este cheie (nu participă la cheia primară) este \textbf{dependent de întreaga cheie primară}.

Relația de mai sus nu se află în FN2 întrucât se găsesc atributele \\\emph{id\_firma(dp), id\_firma(dd),id\_firma(c), marca, nr\_inmatriculare} care nu sunt chei și trebuie să depindă direct de întreaga cheie primară \textbf{id\_transport\#} + \textbf{depozit\_plecare} + \textbf{depozit\_destinatie} + \textbf{id\_camion} + \textbf{id\_inventar\_\\transport\#} + \textbf{id\_lot\_marfa}.
Atributele nu depind direct de întreaga cheie primară, deoarece se observă dependența directă dintre \emph{id\_camion} și \\\emph{id\_firma(c), marca, nr\_inmatriculare} care nu sunt dependente și de \\\emph{depozit\_destinatie} (de exemplu).

Se mai găsesc următoarele dependențe funcționale:
\begin{itemize}
    \item dependența directă dintre \emph{depozit\_plecare} și \emph{id\_locatie(dp), \\id\_firma(dp), id\_echipa\_paza(dp)} care nu sunt dependente și de \\\emph{depozit\_destinație}.
    \item dependența directă dintre \emph{depozit\_destinatie} și \emph{id\_locatie(dd), \\id\_firma(dd), id\_echipa\_paza(dd)} care nu sunt dependente și de \\\emph{depozit\_plecare}.
\end{itemize}

Atributele rămase care nu sunt chei \emph{nume, cantitate, data\_plecare, \\ora\_plecare} depind de întreaga cheie primară întrucât se consideră legătura pentru nume de exemplu:
\begin{itemize}
    \item id\_transport $\rightarrow$ ce marfă a fost transportată într-un transport.
    \item depozit\_plecare $\rightarrow$ ce marfă a plecat din depozit.
    \item depozit\_destinatie $\rightarrow$ ce marfă va fi transportată către depozit.
    \item id\_camion $\rightarrow$ ce marfă va conține camionul.
    \item id\_inventar\_transport $\rightarrow$ ce marfă face parte din inventarierea transportului.
\end{itemize}

Analog pentru celelalte atribute.

Aplicăm regula \emph{Casey-Delobel} pentru FN2:

Avem relația \emph{R(K1, K2, K3, K4, K5, K6, X, Y, Z, W)}, unde \\
\emph{K1=id\_transport\#}, \emph{K2=depozit\_plecare\#}, \emph{K3=depozit\_destinatie\#}, \\\emph{K4=id\_camion\#}, \emph{K5=id\_inventar\_transport\#}, \emph{K6=id\_lot\_marfa\#} \\care definesc cheia primară compusă, iar \emph{X}, \emph{Y}, \emph{Z} și \emph{W} sunt mulțimi de atribute, astfel încât avem dependențele directe: 
\begin{itemize}
    \item \emph{K2}$\rightarrow$\emph{X}, unde \emph{X}=\{\emph{id\_locatie(dp), id\_firma(dp), id\_echipa\_paza(dp)}\}
    \item \emph{K3}$\rightarrow$\emph{Y}, unde \emph{Y}=\{\emph{id\_locatie(dd), id\_firma(dd), id\_echipa\_paza(dd)}\}
    \item \emph{K4}$\rightarrow$\emph{Z}, unde \emph{Z}=\{\emph{id\_firma(c), marca, nr\_inmatriculare}\}
\end{itemize}

În plus avem lista de atribute \emph{W}=\{\emph{nume, cantitate, data\_plecare, \\ora\_plecare}\}.

Din cauza dependențelor funcționale \emph{K2}$\rightarrow$\emph{X}, \emph{K3}$\rightarrow$\emph{Y} și \emph{K4}$\rightarrow$\emph{Z} care arată că \emph{R} nu este în FN2, se înlocuiește R(\emph{fără pierdere de informație}) prin 4 proiecții:
(\emph{K1, K2, K2, K4, K5, K6, Z}), (\emph{K2, X}), (\emph{K3, Y}), (\emph{K4, Z}).

Astfel avem în final proiecțiile:

\begin{itemize}
    \item \{id\_transport\#, depozit\_plecare\#, depozit\_destinatie\#, id\_camion\#, id\_inventar\_transport\#, id\_lot\_marfa\#\} $\rightarrow$ \{nume, cantitate, \\data\_plecare, ora\_plecare\}
    \item \{depozit\_plecare\#\} $\rightarrow$ \{id\_locatie, id\_firma, id\_echipa\_paza\}
    \item \{depozit\_destinatie\#\} $\rightarrow$ \{id\_locatie, id\_firma, id\_echipa\_paza\}
    \item \{id\_camion\#\} $\rightarrow$ \{id\_firma, marca, nr\_inmatriculare\}
\end{itemize}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R1($K_1$, $K_2$, $K_3$, $K_4$, $K_5$, $K_6$, $W$)}}\label{tab10-1}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_ & depozit\_ & depozit\_ & id\_ & id\_inventar\_ & id\_lot\_ & nume & cantitate & data\_ & ora\_ \\
transport\# & plecare\# & destinatie\# & camion\# & transport\# & marfa\# & & & plecare & plecare \\
\hline
10000 & 3000 & 500 & 15 & 100 & 100 & carne miel & 100 & 6-05-2021 & 08$:$00 \\
\hline
10000 & 3000 & 500 & 15 & 155 & 105 & carne porc & 300 & 6-05-2021 & 08$:$00 \\
\hline
10010 & 3000 & 500 & 25 & 210 & 110 & carne pui & 250 & 8-05-2021 & 06$:$00 \\
\hline
10020 & 3500 & 1000 & 35 & 265 & 115 & rosii & 1000 & 6-05-2021 & 08$:$00 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R2($K_2$, $X$)}}\label{tab10-2}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
depozit\_plecare\# & id\_locatie & id\_firma & id\_echipa\_paza \\
\hline
3000 & 100 & 4 & 1100 \\
\hline
3500 & 120 & 10 & 1200 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R3($K_3$, $Y$)}}\label{tab10-3}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
depozit\_destinatie\# & id\_locatie & id\_firma & id\_echipa\_paza \\
\hline
500 & 30 & 2 & 100 \\
\hline
1000 & 50 & 3 & 200 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R4($K_4$, $Z$)}}\label{tab10-4}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_camion & id\_firma & marca & nr\_inmatriculare \\
\hline
15 & 1100 & VOLVO & CT12FSD \\
\hline
25 & 1100 & VOLVO & CT90MMM \\
\hline
35 & 1200 & SCANIA & PH13SCN \\
\hline
\end{tabular}}
\end{center}
\end{table}

Pentru relația \emph{transport} se observă ca a ajuns la 6 chei primare, lucru ineficient în practică, fiind o decizie teribilă, motiv pentru care se înlocuiește cheia primară compusă cu o cheie primară simplă formată doar din \emph{id\_transport}.

\subsection*{Forma normala 3 - exemplu 2}
Relația anterioară se află în forma normală 3 (FN3) daca se află întâi în FN2, lucru realizat anterior, și în plus trebuie să îndeplinească condiția ca fiecare atribut care nu este cheie(nu participă la o cheie) \textbf{să depindă direct de cheia primară}.

Relațiile 2-4 prezentate anterior prin proiecții se află deja în FN3. Se verifică acum relația 1: aceasta este în FN2, transformare realizată anterior, dar nu este în FN3, deoarece se observă că atributele \emph{nume} și \emph{cantitate} depind tranzitiv de cheia primară \emph{id\_transport} prin intermediul atributului \emph{id\_lot\_marfa}, atribut care depinde și el tranzitiv prin intermediul atributului \emph{id\_inventar\_transport}.

Pentru a reduce relația în FN3 se aplică regula \emph{Casey-Delobel}. Relația se descompune, prin eliminarea dependențelor funcționale tranzitive, în proiecții.

Avem relația \emph{R(K, $X_1$, $X_2$, $X_3$, $X_4$)}, unde $K$ este cheia primară id\_transport, $X_1$=\emph{id\_inventar\_transport}, $X_2$=\emph{id\_lot\_marfa}, $X_3$=\{\emph{nume, cantitate}\} și\\ $X_4$=\{\emph{depozit\_plecare, depozit\_destinatie, data\_plecare, ora\_plecare}\}. Sunt \\evidente dependențele tranzitive $K\rightarrow X_1\rightarrow X_2$ și $X_1\rightarrow X_2\rightarrow X_3$.

Din cauza acestor dependențe funcționale relația nu se află în FN3, motiv pentru care se înlocuiește $R$(\textbf{fără pierdere de informație}) prin 3 proiecții $R1(K, X_4)$, $R2(X_1, X_2, K)$ și $R3(X_2, X_3)$. În creearea proiecțiilor s-a ținut cont și de cardinalitățile dintre entități.

\begin{itemize}
    \item \{id\_transport\#\} $\rightarrow$ \{depozit\_plecare, depozit\_destinatie, id\_camion, \\data\_plecare, ora\_plecare\}
    \item \{id\_inventar\_transport\#, id\_lot\_marfa\#\} $\rightarrow$ \{id\_transport\}
    \item \{id\_lot\_marfa\#\} $\rightarrow$ \{nume, cantitate\}
\end{itemize}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R1-1(K, $X_4$)}}\label{tab11-1}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_ & depozit\_ & depozit\_ & id\_ & id\_inventar\_ & id\_lot\_ & data\_ & ora\_ \\
transport\# & plecare\# & destinatie\# & camion\# & transport & marfa\# & plecare & plecare \\
\hline
10000 & 3000 & 500 & 15 & 100 & 100 & 6-05-2021 & 08$:$00 \\
\hline
10000 & 3000 & 500 & 15 & 155 & 105 & 6-05-2021 & 08$:$00 \\
\hline
10010 & 3000 & 500 & 25 & 210 & 110 & 8-05-2021 & 06$:$00 \\
\hline
10020 & 3500 & 1000 & 35 & 265 & 115 & 6-05-2021 & 08$:$00 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R1-2($X_1$, $X_2$, K)}}\label{tab11-2}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_inventar\_transport\# & id\_lot\_marfa & id\_transport \\
\hline
100 & 100 & 10000 \\
\hline
155 & 105 & 10000 \\
\hline
210 & 110 & 10010 \\
\hline
265 & 115 & 10020 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
\caption{Proiectia \emph{R1-3($X_2$, $X_3$)}}\label{tab11-3}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_lot\_marfa\# & nume & cantitate \\
\hline
100 & carne miel & 100 \\
\hline
105 & carne porc & 300 \\
\hline
110 & carne pui & 250 \\
\hline
115 & rosii & 1000 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\newpage
\emph{Obs}: Datele din următoarele tabele/exemple sunt fictive, nu sunt prezente în baza de date creată. S-a ales această metodă pentru o exemplificare mai bună per exemplu. De asemenea vom avea convenția de a adăuga inainte de fiecare cheie primară un string care să semnifice pentru ce entitate este desemnată cheia primară.

\subsection*{Forma normala Boyce-Codd}
Se consideră că o relație R se află în forma normală \textbf{Boyce-Codd} dacă și numai dacă fiecare determinant este o cheie candidat. Un determinant reprezintă un atribut sau o mulțime de atribute neredundante, care constituie un identificator unic pentru un alt atribut sau o altă mulțime de date.

Se dă relația \emph{SOFER\_CONDUCE\_CAMION} în care un șofer poate conduce mai multe camioane care o preluăm din forma normală 1.

\begin{table}[!htbp]
\begin{center}
    \caption{Relatia \emph{SOFER\_CONDUE\_CAMION}}\label{tab12}
\resizebox{\columnwidth}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_istoric         & id\_      & id\_     & id\_  & marca & nr\_    & data\_  & data\_  \\
camioane\_conduse\# & angajat\# & camion\# & firma & & inmatriculare & inceput & sfarsit \\
\hline
ICC1 & A1 & C1 & F1 & DAF & PX13ASD & 06-06-2019 & 07-07-2019 \\
\hline
ICC2 & A2 & C2 & F1 & DAF & PX21QWE & 12-04-2019 & 11-11-2019 \\
\hline
ICC3 & A3 & C3 & F2 & MAN & PX14HGA & 06-05-2019 & 01-12-2019 \\
\hline
ICC3 & A4 & C4 & F3 & DAF & PX13ICC & 06-01-2019 & 07-02-2019 \\
\hline
\end{tabular}}
\end{center}
\end{table}

În relația anterioară se găsește determinantul \emph{X=nr\_inmatriculare} care îl determină funcțional pe \emph{K3=id\_camion\#} și \emph{Y=\{id\_firma, marca\}}, \emph{X} fiind cheie candidat. Astfel aplicăm regula Casey Delobel pentru \emph{R(K1\#, K2\#, K3\#, X, Y, Z)}, unde \emph{K1=id\_istoric\_camioane\_conduse\#}, \emph{K2=id\_angajat\#}, \emph{Z=\{data\_inceput, data\_sfarsit\}}. Astfel se ajunge la proiecțiile: \emph{R1(K1\#, K2\#, X, Z)} și \emph{R2(X\#, K3)} care au adus relația în \emph{BCNF}.

\begin{table}[!htbp]
\begin{center}
    \caption{R1(K1\#, K2\#, X, Z)}\label{tab12-1}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_istoric         & id\_      & nr\_    & data\_  & data\_  \\
camioane\_conduse\# & angajat\# & inmatriculare & inceput & sfarsit \\
\hline
ICC1 & A1 & PX13ASD & 06-06-2019 & 07-07-2019 \\
\hline
ICC2 & A2 & PX21QWE & 12-04-2019 & 11-11-2019 \\
\hline
ICC3 & A3 & PX14HGA & 06-05-2019 & 01-12-2019 \\
\hline
ICC3 & A4 & PX13ICC & 06-01-2019 & 07-02-2019 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
    \caption{R2(X\#, K3)}\label{tab12-2}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
nr\_            & id\_   & marca & id\_  \\
inmatriculare\# & camion &       & firma \\
\hline
PX13ASD & C1 & DAF & F1 \\
\hline
PX21QWE & C2 & DAF & F1 \\
\hline
PX14HGA & C3 & MAN & F2 \\
\hline 
PX13ICC & C4 & DAF & F3 \\
\hline
\end{tabular}}
\end{center}
\end{table}

Analog se procedează și pentru relația \emph{transport}. (În exemplu se vor trece doar atributele de folos pentru exemplul dat)

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport}}\label{tab13}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_depozit & id\_depozit    & id\_lot   & id\_     & nr\_          \\
\_plecare\# & \_destinatie\# & \_marfa\# & camion\# & inmatriculare \\
\hline
D1 & D5 & LM1 & C1 & PX13ASD \\
\hline
D1 & D6 & LM2 & C1 & PX13ASD \\
\hline
D2 & D5 & LM1 & C1 & PX13ASD \\
\hline
D2 & D6 & LM2 & C1 & PX13ASD \\
\hline
D1 & D3 & LM5 & C3 & PX14HGA \\
\hline 
D1 & D3 & LM4 & C4 & PX13ICC \\
\hline
\end{tabular}}
\end{center}
\end{table}

Se găsește analog determinantul \emph{X=nr\_inmatriculare} care determină \\funcțional pe \emph{K4=id\_camion\#}. Se mai fac notațiile \\\emph{K1=id\_depozit\_plecare\#}, \emph{K2=id\_depozit\_destinatie\#}, \emph{K3=id\_lot\_marfa\#}. \\Astfel se ajunge la proiecțiile \emph{R1(K1\#, K2\#, K3\#, X)} și \emph{R2(X\#, K4)}.

\newpage
\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{R1(K1\#, K2\#, K3\#, X)}}\label{tab13-1}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_depozit & id\_depozit    & id\_lot   & nr\_          \\
\_plecare\# & \_destinatie\# & \_marfa\# & inmatriculare \\
\hline
D1 & D5 & LM1 & PX13ASD \\
\hline
D1 & D6 & LM2 & PX13ASD \\
\hline
D2 & D5 & LM1 & PX13ASD \\
\hline
D2 & D6 & LM2 & PX13ASD \\
\hline
D1 & D3 & LM5 & PX14HGA \\
\hline 
D1 & D3 & LM4 & PX13ICC \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{R2(X\#, K4)}}\label{tab13-2}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
nr\_            & id\_ \\
inmatriculare\# & camion \\
\hline
PX13ASD & C1 \\
\hline
PX13ASD & C1 \\
\hline
PX13ASD & C1 \\
\hline
PX13ASD & C1 \\
\hline
PX14HGA & C3 \\
\hline 
PX13ICC & C4 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\subsection*{Forma normala 4}
O relație se află în formă normală 4 (FN4) dacă și numai dacă relația este în BCNF și nu conține relații m:n independente.

Se dă relația anterior transformată(\emph{transport}) în BCNF \emph{R(id\_depozit\_\\destinatie\#, id\_depozit\_plecare\#, id\_lot\_marfa\#, nr\_inmatriculare\#)}

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport}}\label{tab14}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_depozit & id\_depozit    & id\_lot   & nr\_            \\
\_plecare\# & \_destinatie\# & \_marfa\# & inmatriculare\# \\
\hline
D1 & D5 & LM1 & PX13ASD \\
\hline
D1 & D6 & LM2 & PX13ASD \\
\hline
D2 & D5 & LM1 & PX13ASD \\
\hline
D2 & D6 & LM2 & PX13ASD \\
\hline
\end{tabular}}
\end{center}
\end{table}

în care se găsesc următoarele dependențe multiple:

\begin{itemize}
    \item nr\_inmatriculare$\rightarrow\rightarrow$id\_depozit\_plecare
    \item nr\_inmatriculare$\rightarrow\rightarrow$id\_depozit\_destinatie
    \item nr\_inmatriculare$\rightarrow\rightarrow$id\_lot\_marfa
\end{itemize}

și se obțin următoarele rezultate după aplicarea lui FN4:

\begin{itemize}
    \item \emph{transport1=R1(nr\_inmatriculare\#, id\_depozit\_plecare)}
    \item \emph{transport2=R2(nr\_inmatriculare\#, id\_depozit\_destinatie)}
    \item \emph{transport3=R3(nr\_inmatriculare\#, id\_lot\_marfa)}
\end{itemize}

cu următoarele:

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport1}}\label{tab14-1}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
nr\_            & id\_depozit \\
inmatriculare\# & \_plecare\# \\
\hline
PX13ASD & D1 \\
\hline
PX13ASD & D2 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport2}}\label{tab14-2}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
nr\_            & id\_depozit    \\
inmatriculare\# & \_destinatie\# \\
\hline
PX13ASD & D5\\
\hline
PX13ASD & D6 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport3}}\label{tab14-3}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
nr\_            & id\_lot\_ \\
inmatriculare\# & marfa\#   \\
\hline
PX13ASD & LM1 \\
\hline
PX13ASD & LM2 \\
\hline
\end{tabular}}
\end{center}
\end{table}

\newpage

\subsection*{Forma normala 5}
O relație se află în formă normală 5 (FN5) dacă și numai dacă se află în FN4 și nu conține dependențe ciclice.

Se dă exemplul următor: un lot de marfă poate fi transportat de la mai multe depozite la mai multe depozite și poate să fie transportat de mai multe camioane. Aceasta relație este una de tip 3 și are reprezentarea:

\includegraphics[width=\textwidth]{fn5_rel_3.png}
\label{rel3}
\centering Relatie tip 3

\justifying 
cu posibilele întregistrări:

\begin{table}[!htbp]
\begin{center}
    \caption{Relația \emph{transport}}\label{tab15}
\resizebox{\width}{!}{\begin{tabular}{| l | l | l | l | l | l | l | l | l | l | l | l |}
\hline
id\_depozit & id\_depozit    & id\_lot   & nr\_            \\
\_plecare\# & \_destinatie\# & \_marfa\# & inmatriculare\# \\
\hline
D1 & D5 & LM1 & PX13ASD \\
\hline
D1 & D6 & LM2 & PX13ASD \\
\hline
D2 & D5 & LM1 & PX13ASD \\
\hline
D2 & D6 & LM2 & PX13ASD \\
\hline
\end{tabular}}
\end{center}
\end{table}

Această relație de tip 3 poate fi echivalentă cu 4 relații de tip 2 doar dacă aceste relații de tip 2 sunt ciclice.

\includegraphics[width=\textwidth]{fn5_rel_2.png}
\label{rel2}
\centering Relatie tip 2

\justifying Relația fiind ciclică, atunci când se va face o interogare cu toate join-urile se va obține un rezultat echivalent cu cel obținut din interogarea relației de tip 3. Anterior au fost menționate condițiile ca o relație să fie în FN5, printre care și condiția de a nu conține dependențe ciclice, motiv pentru care cele 3 relații de tip 2 compun o diagramă care conține dependențe ciclice, deci relația nu se află în FN5. În schimb relația de tip 3 se află în FN5.

\newpage
\section{Denormalizare}
Denormalizarea presupune mărirea redundanței pentru a reduce numărul de join-uri care trebuie efectuate pentru rezolvarea unei interogări, astfel se micșorează timpul de execuție.

$\rightarrow$Exemplu când denormalizarea nu este utilă:

În tabelul \emph{LOT\_MARFA} în care sunt stocate loturile de marfă din transporturile efectuate. Loturile de marfă au atributele \textbf{nume} și \textbf{cantitate} care pot conține valori repetitive, aceeași cantitate putând aparținând mai multor loturi de marfă, analog pentru nume. Dacă în baza de date există un tabel separat pentru cantitate și unul pentru nume, fiecare împreună cu id-ul lotului de marfă căruia îi corespunde, este necesar să se aplice procesul de denormalizare în urma căruia atributele nume și cantitate se vor plasa în tabelul \emph{LOT\_MARFA} întrucât ar fi ineficient ca în interogări aceste atribute să se afle în tabele separate datorită unui dublu join care ar mări timpul de execuție în cazul în care se dorește aflarea tuturor informațiilor despre un anumit lot de marfă.

$\rightarrow$Exemplu când denormalizarea este utilă:
În tabelul \emph{ANGAJAT} există atributul \textbf{id\_firma} care reprezintă o cheie externă pentru o cheie primară din tabelul \emph{FIRMA}, acest atribut desemnând la ce firmă lucrează un angajat. Cu toate acestea se poate afla la ce firmă lucrează un angajat dacă se realizează un join între \emph{ANGAJAT}, \emph{ISTORIC\_CAMIOANE\_CONDUSE}, \emph{CAMION} și \emph{FIRMA} pentru un angajat de tip șofer și un join între \emph{ANGAJAT}, \emph{ECHIPA\_PAZA} și \emph{FIRMA}. Este deja evident că pentru aflarea acestei informații (la ce firmă lucreaza un angajat/ce angajați lucreaza la o firmă) o interogare ar avea un număr de join-uri prea mare pentru ce informație se dorește. Astfel se realizează denormalizarea acestui tabel prin adăugarea atributului \textbf{id\_firma} pentru a reduce nr. de join-uri din posibilele interogări dorite, lucru care rezultă într-un timp de execuție mai mic. Astfel această denormalizare se dovedește utilă.

\newpage

\newpage
\section{Optimizarea unei cereri - ex17}

Se cer următoarele informații:

Pentru fiecare camion să se afișeze marca, nr. de înmatriculare, numele firmei, de ce șoferi a fost condus(pentru fiecare șofer să se precizeze numele, prenumele și salariul, în cazul în care un camion nu a fost condus de un șofer să se înlocuiască aceste coloane cu '-'), dar și data de plecare pentru fiecare transport realizat de șofer cu acest camion. Dacă unui angajat i-a fost alocat un camion dar nu a realizat niciun transport in loc de dată să fie afișat mesajul 'nu a realizat transporturi'. Să se afișeze informațiile despre angajați doar dacă sunt șoferi, au fost angajați înainte de data de 13 sept 2020 si dețin cel putin un permis auto, în cazul în care un camion a fost condus de un șofer care nu îndeplinește aceste cerințe se vor înlocui coloanele cu informații despre angajat cu '-'. Să se excludă camioanele de marcă IVECO.

Prima cerere \emph{SQL} implementată:

\begin{lstlisting}[language=SQL]
WITH ang AS -- soferii angajati inainte de 13 sept 2020 care detin cel mult 2 permise auto
    (SELECT p.id_angajat, a.nume, a.prenume, a.salariu
     FROM angajat a JOIN permis p ON (a.id_angajat = p.id_angajat)
     WHERE a.tip_angajat = 'SOFER'
        and to_char(a.data_angajare, 'dd-mm-yyyy') < '13-9-2020' 
     GROUP BY p.id_angajat, a.nume, a.prenume, a.salariu
     HAVING count(p.id_angajat) >= 1  -- care detine cel putin 1 permis  
     )

SELECT c.marca, c.nr_inmatriculare, f.nume, 
       NVL(a.nume, '-') "Nume sofer", NVL(a.prenume, '-') "Prenume sofer", 
       NVL(to_char(a.salariu), '-') "Salariu sofer",
       NVL(to_char(t.data_plecare, 'dd-mm-yyyy'), 'nu a realizat transporturi') "Data transport"
FROM camion c JOIN firma f ON (c.id_firma = f.id_firma)
              FULL OUTER JOIN istoric_camioane_conduse icc ON (c.id_camion = icc.id_camion)
              FULL OUTER JOIN ang a ON (icc.id_angajat = a.id_angajat)
              FULL OUTER JOIN transport t ON (c.id_camion = t.id_camion)
WHERE
    upper(c.marca) != 'IVECO' and
    f.tip_firma = 'TRANSPORT' and 
    ((icc.data_inceput < t.data_plecare and t.data_plecare <= NVL(icc.data_sfarsit, sysdate)
     )   or t.data_plecare is null
    );
\end{lstlisting}

\newpage
S-a realizat următorul arbore algebric asociat cererii:

\includegraphics[width=\textwidth]{arbore_v1.png}
\label{arbore_v1}
\centering Arbore v1

\newpage\justifyingși expresia algebrică asociată:

\begin{lstlisting}
R1=SELECT(CAMION, upper(marca)!='IVECO')
R2=PROJECT(R1, id_camion, id_firma, marca, nr_inmatriculare}
R3=SELECT(FIRMA, tip_firma='TRANSPORT')
R4=PROJECT(R3, id_firma, nume)
R5=JOIN(R2, R4, id_firma)
R6=PROJECT(TRANSPORT, id_camion, data_plecare)
R7=FULL OUTER JOIN(R5, R6, id_camion)
R8=PROJECT(ISTORIC_CAMIOANE_CONDUSE, id_camion, id_angajat, data_inceput, data_sfarsit)
R9=FULL OUTER JOIN(R7, R8, id_camion)
R10=SELECT(R9, (icc.data_inceput < t.data_plecare and t.data_plecare <= NVL(icc.data_sfarsit, sysdate)) or t.data_plecare is null)
R11=SELECT(ANGAJAT, tip_angajat = 'SOFER' and to_char(data_angajare, 'dd-mm-yyyy') < '13-9-2020')
R12=PROJECT(R11, id_angajat, nume, prenume, salariu)
R13=PROJECT(PERMIS, id_angajat)
R14=JOIN(R12, R13, count(p.id_angajat) >= 1)
R15=PROJECT(R14, id_angajat, nume, prenume, salariu)
R16=FULL OUTER JOIN(R10, R15, id_angajat)
Rez=R17=PROJECT(R16, marca, nr_inmatriculare, nume, NVL(nume, '-'), NVL(prenume, '-'), NVL(to_char(salariu), '-'), NVL(to_char(t.data_plecare, 'dd-mm-yyyy'), 'nu a realizat transporturi'))
\end{lstlisting}

Se observă faptul că deja o parte a arborelui este optimizată folosind proprietatea de compunere a proiecțiilor și de compunere a selecțiilor.

Se fac următoarele optimizări:

\begin{itemize}
    \item se folosește regula de optimizare 1 care spune că selecțiile se execută cât mai devreme posibil pentru R10, selecție care ar putea fi realizată mai devreme, totodată se va folosi și proprietatea 2 care spune că operațiile de join și produs cartezian sunt asociative. În alegerea primelor join-uri vom folosi și regula de optimizare 3 care spune că dacă există mai multe join-uri atunci cel care se execută primul este cel mai restrictiv. Astfel se va face un \emph{FULL OUTER JOIN} între \emph{CAMION} și \emph{ISTORIC\_CAMIOANE\_CONDUSE} după un alt \emph{FULL OUTER JOIN} între rezultatul anterior și \emph{TRANSPORT} după care vom face selecția care anterior era R10 și o proiecție pentru a elimina atributele nefolositoare.
\end{itemize}

\newpage
Și se ajunge la următorul arborele algebric:

\includegraphics[width=\textwidth]{arbore_v2.png}
\label{arbore_v2}
\centering Arbore v2 optimizat

\newpage\justifyingși expresia algebrică asociată:
\begin{lstlisting}
R1=SELECT(CAMION, upper(marca)!='IVECO')
R2=PROJECT(R1, id_camion, id_firma, marca, nr_inmatriculare}
R3=PROJECT(ISTORIC_CAMIOANE_CONDUSE, id_camion, id_angajat, data_inceput, data_sfarsit)
R4=FULL OUTER JOIN(R2, R3, id_camion)
R5=PROJECT(TRANSPORT, id_camion, data_plecare)
R6=FULL OUTER JOIN(R4, R5, id_camion)
R7=SELECT(R6, (icc.data_inceput < t.data_plecare and t.data_plecare <= NVL(icc.data_sfarsit, sysdate)) or t.data_plecare is null)
R8=PROJECT(R7, icc.id_camion, icc.id_angajat, t.data_plecare, c.marca, c.nr_inmatriculare, c.id_firma)
R9=SELECT(FIRMA, tip_firma='TRANSPORT')
R10=PROJECT(R9, id_firma, nume)
R11=JOIN(R8, R10, id_firma)
R12=SELECT(ANGAJAT, tip_angajat = 'SOFER' and to_char(data_angajare, 'dd-mm-yyyy') < '13-9-2020')
R13=PROJECT(R12, id_angajat, nume, prenume, salariu)
R14=PROJECT(PERMIS, id_angajat)
R15=JOIN(R13, R14, count(p.id_angajat) >= 1)
R16=PROJECT(R15, id_angajat, nume, prenume, salariu)
R17=FULL OUTER JOIN(R11, R16, id_angajat)
Rez=R18=PROJECT(R17, marca, nr_inmatriculare, nume, NVL(nume, '-'), NVL(prenume, '-'), NVL(to_char(salariu), '-'), NVL(to_char(t.data_plecare, 'dd-mm-yyyy'), 'nu a realizat transporturi'))
\end{lstlisting}

Cererea optimizată finală este:

\begin{lstlisting}[language=SQL]
WITH ang AS -- soferii angajati inainte de 13 sept 2020 care detin cel mult 2 permise auto
    (SELECT p.id_angajat, a.nume, a.prenume, a.salariu
     FROM angajat a JOIN permis p ON (a.id_angajat = p.id_angajat)
     WHERE a.tip_angajat = 'SOFER'
        and to_char(a.data_angajare, 'dd-mm-yyyy') < '13-9-2020' 
     GROUP BY p.id_angajat, a.nume, a.prenume, a.salariu
     HAVING count(p.id_angajat) >= 1  -- care detine cel putin 1 permis  
     ),
     tc AS
     (SELECT icc.id_camion, icc.id_angajat, t.data_plecare, c.marca, c.nr_inmatriculare, c.id_firma
      FROM camion c FULL OUTER JOIN istoric_camioane_conduse icc ON (c.id_camion = icc.id_camion)
                    FULL OUTER JOIN transport t ON (c.id_camion = t.id_camion)
      WHERE c.marca != 'IVECO' and
            (t.data_plecare is null or icc.data_inceput is null or 
             (icc.data_inceput < t.data_plecare and t.data_plecare <= NVL(icc.data_sfarsit, sysdate))
             )
      )
    
SELECT tc.marca, tc.nr_inmatriculare, f.nume, 
       NVL(a.nume, '-') "Nume sofer", NVL(a.prenume, '-') "Prenume sofer", 
       NVL(to_char(a.salariu), '-') "Salariu sofer",
       NVL(to_char(tc.data_plecare, 'dd-mm-yyyy'), 'nu a realizat transporturi') "Data transport" 
FROM tc JOIN firma f ON (tc.id_firma = f.id_firma)
        FULL OUTER JOIN ang a ON (tc.id_angajat = a.id_angajat)
WHERE f.tip_firma = 'TRANSPORT';
\end{lstlisting}

\newpage
\section{Cod SQL pentru crearea tabelelor - ex10}
\begin{lstlisting}[language=SQL]
-- creearea tabelelor

CREATE TABLE LOCATIE
    (id_locatie number(10) constraint pk_loc primary key,
     judet varchar2(25),
     localitate varchar2(25),
     strada varchar2(25),
     nr number(5)
     );

CREATE TABLE POPAS
    (id_popas number(10) constraint pk_pop primary key,
     id_locatie number(10) constraint fk_pop_loc references
                                LOCATIE(id_locatie) on delete set null,
     nume varchar2(25),
     tip_popas varchar2(10) constraint tip_pop not null,
     constraint verif_tip_pop check(tip_popas = 'BENZINARIE'
                            or tip_popas = 'MOTEL' or tip_popas = 'RESTAURANT')
     );

CREATE TABLE FIRMA
    (id_firma number(12) constraint pk_firma primary key,
     nume varchar2(25) constraint uni_nume_firma unique,
     tip_firma varchar2(10) constraint tip_firma not null,
     constraint verif_tip_firma check(tip_firma = 'CLIENT' or tip_firma = 'PAZA'
                                        or tip_firma = 'TRANSPORT')
     );

CREATE TABLE ECHIPA_PAZA
    (id_echipa_paza number(5) constraint pk_epaza primary key,
     id_firma number(12) constraint fk_epaza_firma references
                            FIRMA(id_firma) on delete cascade
     );

CREATE TABLE DEPOZIT
    (id_depozit number(5) constraint pk_dep primary key,
     id_locatie number(5) constraint fk_dep_loc references
                            LOCATIE(id_locatie) on delete set null,
     id_echipa_paza number(5) constraint fk_dep_epaza
                references ECHIPA_PAZA(id_echipa_paza) on delete set null,
     id_firma number(12) constraint fk_dep_firma references FIRMA(id_firma)
                            on delete set null
     );

CREATE TABLE CAMION
    (id_camion number(5) constraint pk_cam primary key,
     marca varchar2(10),
     nr_inmatriculare varchar2(10) constraint uni_nr_ing_cam unique,
     id_firma number(12) constraint fk_cam_firma references
                            FIRMA(id_firma) on delete set null
     );

CREATE TABLE TRANSPORT
    (id_transport number(10) constraint pk_trans primary key,
     depozit_plecare number(5) constraint fk_trans_dep_p references
                                    DEPOZIT(id_depozit) on delete cascade,
     depozit_destinatie number(5) constraint fk_trans_dep_d references
                                    DEPOZIT(id_depozit) on delete cascade,
     id_camion number(5) constraint fk_trans_cam references
                            CAMION(id_camion) on delete cascade,
     data_plecare date default sysdate
     );

CREATE TABLE LOT_MARFA
    (id_lot_marfa number(10) constraint pk_lotm primary key,
     nume varchar2(25) constraint nume_lotm not null,
     cantitate number(8, 2) constraint cant_lotm not null
     );

CREATE TABLE INVENTAR_DEPOZIT
    (id_inventar_depozit number(10) constraint pk_inv_dep primary key,
     id_depozit number(5) constraint fk_invdep_dep references
                                DEPOZIT(id_depozit) on delete cascade,
     id_lot_marfa number(10) constraint fk_invdep_lotm references
                                LOT_MARFA(id_lot_marfa) on delete cascade,
     data_sosire date default sysdate,
     data_plecare date
     );

CREATE TABLE INVENTAR_TRANSPORT
    (id_inventar_transport number(10),
     id_lot_marfa number(10) constraint fk_invtran_lotm references
                                LOT_MARFA(id_lot_marfa) on delete cascade,
     id_transport number(10) constraint fk_invtran_tran references
                                TRANSPORT(id_transport) on delete cascade,
     constraint pk_inv_tran primary key(id_inventar_transport, id_lot_marfa)
     );

CREATE TABLE ANGAJAT
    (id_angajat number(10) constraint pk_ang primary key,
     nume varchar(25),
     prenume varchar(25),
     nr_telefon varchar(14),
     data_angajare date default sysdate,
     salariu number(10),
     id_firma number(12),
     tip_angajat char(6) constraint tip_ang_nn not null,
     id_echipa_paza number(5),
     constraint verf_tip check(tip_angajat = 'PAZNIC' or tip_angajat = 'SOFER'),
     constraint fk_ang_epaza foreign key(id_echipa_paza)
        references ECHIPA_PAZA(id_echipa_paza) on delete set null,
     constraint fk_ang_firma foreign key(id_firma)
        references FIRMA(id_firma) on delete set null
     );

CREATE TABLE ISTORIC_CAMIOANE_CONDUSE
    (id_istoric_camioane_conduse number(10) constraint pk_ist_cam primary key,
     id_angajat number(10) constraint fk_icam_ang references
                            ANGAJAT(id_angajat) on delete cascade,
     id_camion number(5) constraint fk_icam_cam references
                            CAMION(id_camion) on delete cascade,
     data_inceput date default sysdate,
     data_sfarsit date
     );

CREATE TABLE PERMIS
    (id_permis number(10),
     id_angajat number(10) constraint fk_perm_ang references
                            ANGAJAT(id_angajat) on delete cascade,
     categorie char(3),
     data date default sysdate,
     constraint pk_perm primary key(id_permis, id_angajat),
     constraint verf_catg check(categorie in ('AM', 'A1', 'A2', 'A', 'B1', 'B',
        'BE', 'C1', 'C1E', 'C', 'CE', 'D1', 'D1E', 'D', 'DE', 'Tr', 'Tb', 'Tv'))
     );

CREATE TABLE ISTORIC_POPASURI
    (id_istoric_popas number(20),
     id_popas number(10) constraint fk_istpop_pop references POPAS(id_popas),
     id_angajat number(10) constraint fk_istpop_ang references ANGAJAT(id_angajat),
     data_sosire date default sysdate,
     data_plecare date default sysdate,
     constraint pk_ist_pop primary key(id_istoric_popas, id_popas, id_angajat, data_sosire)
     );
\end{lstlisting}

\newpage
\section{Inserarea de date in tabel + utilizarea \\secventelor - ex 10 + 13}
\begin{lstlisting}[language=SQL]
/* pentru tabelul Locatie se creeaza urmatoarea secventa SEQ_LOC pentru inserarea
 * inregistrarilor in tabelul Locatie, se va proceda analog pentru celelalte
 * exemple fara a se mai specifica intr-un comentariu */
CREATE SEQUENCE SEQ_LOC
INCREMENT BY 10
START WITH 10
MAXVALUE 1000000000
NOCYCLE;

/* se insereaza date in tabelul Locatie folosind secventa anterior creata
 * utilizandu-se metoda implicita | se va proceda analog pentru inserarea de
 * date in celelalte tabele fara a se mai specifica intr-un comentariu */
INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Prahova', 'Ploiesti', 'Libertatii', 13);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Prahova', 'Ploiesti', 'Lalelelor', 142);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Prahova', 'Ploiesti', 'Primaverii', 412);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Iasi', 'Iasi', 'Unirii', 9991);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Iasi', 'Iasi', 'Mihai Eminescu', 991);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Iasi', 'Iasi', 'Teilor', 131);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Constanta', 'Constanta', 'Teilor', 21);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Constanta', 'Constanta', 'Victoriei', 123);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Constanta', 'Constanta', 'Zorilor', 13);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Tulcea', 'Tulcea', 'Unirii', 213);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Tulcea', 'Tulcea', 'Victoriei', 113);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Ilfov', 'Bucuresti', 'Libertatii', 112);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Ilfov', 'Bucuresti', '1 mai', 1213);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Ilfov', 'Bucuresti', 'Muncii', 1412);

INSERT INTO LOCATIE
VALUES(SEQ_LOC.NEXTVAL, 'Ilfov', 'Bucuresti', 'Unirii', 212);

CREATE SEQUENCE SEQ_POP
INCREMENT BY 20
START WITH 100
MAXVALUE 1000000000
NOCYCLE;

INSERT INTO POPAS
VALUES(SEQ_POP.NEXTVAL, 10, 'Motel Sunday', 'MOTEL');

INSERT INTO POPAS
VALUES(SEQ_POP.NEXTVAL, 20, 'Restaurant Ceptura', 'RESTAURANT');

INSERT INTO POPAS
VALUES(SEQ_POP.NEXTVAL, 40, 'Restaurant Grand', 'RESTAURANT');

INSERT INTO POPAS
VALUES(SEQ_POP.NEXTVAL, 60, 'Restaurant Unirea', 'RESTAURANT');

INSERT INTO POPAS
VALUES(SEQ_POP.NEXTVAL, 70, 'Conacul dintre vii', 'MOTEL');

CREATE SEQUENCE SEQ_FIRMA
INCREMENT BY 100
START WITH 100
MAXVALUE 1000000
NOCYCLE;

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Lidl', 'CLIENT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Profi', 'CLIENT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'ABOUT YOU', 'CLIENT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Deichmann', 'CLIENT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'H and M', 'CLIENT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'STOP SEAL GUARD', 'PAZA');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'ATMAN PROTECTION', 'PAZA');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'GARDIENII', 'PAZA');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'QUICK PROTECT', 'PAZA');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'JOHNNY VIP SECURITY', 'PAZA');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Road Logistics', 'TRANSPORT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Transibo', 'TRANSPORT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'EasyCargo', 'TRANSPORT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'Lextom Trans Asd', 'TRANSPORT');

INSERT INTO FIRMA
VALUES(SEQ_FIRMA.NEXTVAL, 'FedEx', 'TRANSPORT');

INSERT INTO ECHIPA_PAZA
VALUES(1, 600);

INSERT INTO ECHIPA_PAZA
VALUES(2, 600);

INSERT INTO ECHIPA_PAZA
VALUES(3, 800);

INSERT INTO ECHIPA_PAZA
VALUES(4, 700);

INSERT INTO ECHIPA_PAZA
VALUES(5, 900);

INSERT INTO ECHIPA_PAZA
VALUES(6, 1000);

INSERT INTO ECHIPA_PAZA
VALUES(7, 1000);

INSERT INTO ECHIPA_PAZA
VALUES(8, 600);

INSERT INTO ECHIPA_PAZA
VALUES(9, 700);

INSERT INTO ECHIPA_PAZA
VALUES(10, 600);

CREATE SEQUENCE SEQ_DEP
INCREMENT BY 500
START WITH 500
MAXVALUE 50000
NOCYCLE;

INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 30, 2, 100);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 50, 3, 200);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 80, 1, 300);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 90, 5, 400);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 110, 6, 500);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 100, 4, 1100);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 120, 10, 1200);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 140, 8, 1300);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 150, 7, 1400);
INSERT INTO DEPOZIT
VALUES(SEQ_DEP.NEXTVAL, 130, 9, 1500);

CREATE SEQUENCE SEQ_CAM
INCREMENT BY 10
START WITH 15
MAXVALUE 10000
NOCYCLE;

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'VOLVO', 'CT12FSD', 1100);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'VOLVO', 'CT90MMM', 1100);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'SCANIA', 'PH13SCN', 1200);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'DAF', 'B55ASD', 1300);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'IVECO', 'MM13IVC', 1400);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'MAN', 'TM20QWE', 1100);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'SCANIA', 'IS32ISA', 1100);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'MAN', 'IS01MAN', 1200);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL,'DAF', 'TM11IOP', 1300);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'VOLVO', 'MM57RXF', 1500);

INSERT INTO CAMION
VALUES(SEQ_CAM.NEXTVAL, 'SCANIA', 'B29SCN', 1500);

CREATE SEQUENCE SEQ_TRAN
INCREMENT BY 10
START WITH 10000
MAXVALUE 2000000000
NOCYCLE;

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3000, 500, 15, to_date('06-05-2021 08:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3000, 500, 25, to_date('08-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3500, 1000, 35, to_date('06-05-2021 08:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 4000, 1000, 45, to_date('06-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 4500, 1000, 55, to_date('06-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 5000, 1500, 115, to_date('07-05-2021 08:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 5000, 1500, 105, to_date('05-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3500, 2000, 85, to_date('06-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3500, 2000, 85, to_date('07-05-2021 06:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3000, 2500, 25, to_date('10-05-2021 07:00', 'dd-mm-yyyy, hh24:mi'));

INSERT INTO TRANSPORT
VALUES(SEQ_TRAN.NEXTVAL, 3000, 2500, 15, to_date('11-05-2021 05:00', 'dd-mm-yyyy, hh24:mi'));

CREATE SEQUENCE SEQ_LOTM
INCREMENT BY 5
START WITH 100
MAXVALUE 5000000000
NOCYCLE;

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'carne miel', 100.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'carne porc', 300.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'carne pui', 250.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'carne pui', 200.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'rosii', 1000.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'rosii', 1500.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'ardei', 500.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'lapte', 100.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'lapte', 100.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'lapte', 120.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'tricouri', 100.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'tricouri', 90.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'tricouri', 10.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'pantofi', 20.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'pantofi', 30.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'hanorace', 50.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'hanorace', 35.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'rochii', 50.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'fuste', 35.00);

INSERT INTO LOT_MARFA
VALUES(SEQ_LOTM.NEXTVAL, 'blugi', 35.00);

CREATE SEQUENCE SEQ_INV_DEP
INCREMENT BY 50
START WITH 100
MAXVALUE 500000000
NOCYCLE;

--10040
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 100, to_date('02-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
--10040
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 105, to_date('02-04-2021 10:00', 'dd-mm-yyyy hh24:mi'), null);
--10050
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 110, to_date('01-04-2021 11:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 115, to_date('25-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10060
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3500, 120, to_date('24-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3500, 130, to_date('07-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10070
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 4000, 140, to_date('12-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10080
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 4500, 125, to_date('21-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 4500, 145, to_date('13-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10090
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 195, to_date('11-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10100
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 150, to_date('14-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 175, to_date('02-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10110
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3500, 165, to_date('03-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10120
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3500, 170, to_date('02-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10130
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 190, to_date('06-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 185, to_date('01-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

--10140
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 3000, 180, to_date('15-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 160, to_date('11-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 155, to_date('11-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);
INSERT INTO INVENTAR_DEPOZIT
VALUES(SEQ_INV_DEP.NEXTVAL, 5000, 135, to_date('11-04-2021 12:00', 'dd-mm-yyyy hh24:mi'), null);


CREATE SEQUENCE SEQ_INV_TRAN
INCREMENT BY 55
START WITH 100
MAXVALUE 500000000
NOCYCLE;

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 100, 10000);
INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 105, 10000);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 110, 10010);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 120, 10020);
INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 130, 10020);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 140, 10030);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 125, 10040);
INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 145, 10040);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 195, 10050);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 150, 10060);
INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 175, 10060);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 165, 10070);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 170, 10080);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 190, 10090);
INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 185, 10090);

INSERT INTO INVENTAR_TRANSPORT
VALUES(SEQ_INV_TRAN.NEXTVAL, 180, 10100);

CREATE SEQUENCE SEQ_ANG
INCREMENT BY 20
START WITH 20000
MAXVALUE 2000000000
NOCYCLE;

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Ion', 'Vasile', '0722123456', 
    to_date('11-04-2020 12:00', 'dd-mm-yyyy hh24:mi'), 5000, 1100, 'SOFER', null);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Ovidiu', 'Ion', '0727124356', 
    to_date('12-05-2020 12:00', 'dd-mm-yyyy hh24:mi'), 4000, 1100, 'SOFER', null);
    
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Popescu', 'Andrei', '0723323465', 
    to_date('11-03-2020 12:00', 'dd-mm-yyyy hh24:mi'), 6000, 1200, 'SOFER', null);
    
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Marian', 'Gheorghe', '0721213456', 
    to_date('11-11-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3000, 1200, 'SOFER', null);
    
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Manea', 'George', '0721123959', 
    to_date('03-03-2020 12:00', 'dd-mm-yyyy hh24:mi'), 4000, 1300, 'SOFER', null);
    
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Constantin', 'Gheorghe', '0735123456', 
    to_date('09-04-2020 12:00', 'dd-mm-yyyy hh24:mi'), 4500, 1400, 'SOFER', null);
    
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Ion', 'Catalin', '0721126566', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3400, 1500, 'SOFER', null);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Marius', 'Catalin', '072119356', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3300, 600, 'PAZNIC', 1);
INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Grant', 'Ion', '0723123456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3100, 600, 'PAZNIC', 1);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Ivan', 'George', '0726100456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3250, 600, 'PAZNIC', 2);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Neagu', 'Ion', '0728123456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3500, 800, 'PAZNIC', 3);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Popescu', 'Cristian', '0724523456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3600, 700, 'PAZNIC', 4);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Marius', 'Mihai', '0721223456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3450, 900, 'PAZNIC', 5);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Radu', 'Gheorghe', '0724323456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3375, 1000, 'PAZNIC', 6);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Marin', 'Catalin', '0725623456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3150, 1000, 'PAZNIC', 7);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Andrei', 'David', '0722123456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3250, 600, 'PAZNIC', 8);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Popescu', 'Stefan', '0721145456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3400, 700, 'PAZNIC', 9);

INSERT INTO ANGAJAT
VALUES(SEQ_ANG.NEXTVAL, 'Ion', 'Catalin', '0721765456', 
    to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 3320, 600, 'PAZNIC', 10);
         
CREATE SEQUENCE SEQ_IST_CAM
INCREMENT BY 5
START WITH 5
MAXVALUE 2000000000
NOCYCLE;

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20000, 65, to_date('11-04-2020 12:00', 'dd-mm-yyyy hh24:mi'), 
    to_date('13-07-2020 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20000, 75, to_date('13-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 
    to_date('21-11-2020 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20000, 15, to_date('21-11-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20020, 25, to_date('12-05-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20040, 85, to_date('11-03-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20060, 35, to_date('11-11-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20080, 45, to_date('03-03-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20100, 55, to_date('09-04-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20120, 105, to_date('02-07-2020 12:00', 'dd-mm-yyyy hh24:mi'), 
        to_date('06-06-2020 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_CAMIOANE_CONDUSE
VALUES(SEQ_IST_CAM.NEXTVAL, 20120, 115, to_date('06-06-2020 12:00', 'dd-mm-yyyy hh24:mi'), null);

CREATE SEQUENCE SEQ_PERM
INCREMENT BY 2
START WITH 1
MAXVALUE 1000000000
NOCYCLE;

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20000,'C', to_date('06-06-2017 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20000,'A', to_date('06-06-2013 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20000,'B', to_date('06-06-2012 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20020,'C', to_date('06-06-2018 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20040,'C', to_date('06-05-2016 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20060,'C', to_date('03-11-2014 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20080,'C', to_date('03-03-2002 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20100,'B', to_date('06-11-2010 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20100,'C', to_date('06-11-2012 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO PERMIS
VALUES(SEQ_PERM.NEXTVAL, 20120,'C', to_date('12-06-2014 12:00', 'dd-mm-yyyy hh24:mi'));

CREATE SEQUENCE SEQ_IST_POP
INCREMENT BY 5
START WITH 50
MAXVALUE 10000000000000000000
NOCYCLE;

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 180, 20000, to_date('06-05-2021 10:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 120, 20000, to_date('06-05-2021 21:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 21:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 180, 20020, to_date('08-05-2021 10:00', 'dd-mm-yyyy hh24:mi'), to_date('08-05-2021 12:00', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 120, 20020, to_date('08-05-2021 21:00', 'dd-mm-yyyy hh24:mi'), to_date('08-05-2021 21:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 100, 20060, to_date('06-05-2021 10:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 10:20', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 140, 20060, to_date('06-05-2021 19:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 19:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 140, 20080, to_date('06-05-2021 17:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 17:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 140, 20100, to_date('06-05-2021 17:00', 'dd-mm-yyyy hh24:mi'), to_date('06-05-2021 17:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 180, 20120, to_date('07-05-2021 17:00', 'dd-mm-yyyy hh24:mi'), to_date('07-05-2021 17:30', 'dd-mm-yyyy hh24:mi'));

INSERT INTO ISTORIC_POPASURI
VALUES(SEQ_IST_POP.NEXTVAL, 180, 20120, to_date('05-05-2021 17:00', 'dd-mm-yyyy hh24:mi'), to_date('05-05-2021 17:30', 'dd-mm-yyyy hh24:mi'));

commit; -- salvam inserarile
\end{lstlisting}

\newpage
\section{Cereri SQL - ex11}
\begin{lstlisting}[language=SQL]
/* 11. Formulati in limbaj natural si implementati 5 cereri SQL complexe ce vor
 * utiliza, in ansamblul lor, urmatoarele elemente:
 * - operatie join pe cel putin 4 tabele
 * - filtrare la nivel de linii
 * - subcereri sincronizate in care intervin cel putin 3 tabele
 * - subcereri nesincronizate in care intervin cel putin 3 tabele
 * - grupari de date, functii grup, filtrare la nivel de grupuri
 * - ordonari
 * - utilizarea a cel putin 2 functii pe siruri de caractere, 2 functii pe date
 * calendaristice, a functiilor NVL si DECODE, a cel putin unei expresii CASE
 * utilizarea a cel putin 1 bloc de cerere (clauza WITH) */

-- 1

/* Afisati pentru toti soferi toate popasurile in care s-au oprit in ziua in care
 * s-a oprit pentru prima data un sofer la restaurantul Ceptura din Ploiesti, sa
 * se afiseze daca soferul a venit cu un camion inmatriculat in Prahova sau in
 * alta regiune, numele, prenumele si salariul soferului, numele si tipul
 * popasului la care s-a oprit, la ce ora a sosit, cat a stat, cati bani a
 * cheltuit la popas, si locatia popasului. Locatia sa fie afisata pe o singura
 * coloana numita Locatie popas. Un sofer cheltuieste la un popas in functie de
 * salariul sau, soferii cu un salariu mai mic de 3000lei inclusiv vor cheltui doar
 * 0.005% din salariu, cei cu salariu intre (3000, 4500] vor chelui 0.01% din
 * salariu, iar restul vor cheltui 0.015% din salariu. Sa se ordoneze dupa nume
 * si dupa prenume. Sa se noteze restul coloanelor corespunzator */

WITH psp(ds) AS -- data primei opriri a unui sofer la Restaurantul Ceptura din Ploiesti
    (SELECT to_char(min(sip.data_sosire), 'dd-mm-yyyy')
     FROM locatie sl JOIN popas sp ON (sl.id_locatie = sp.id_locatie)
                     JOIN istoric_popasuri sip ON(sp.id_popas = sip.id_popas)
     WHERE initcap(sp.nume) = 'Restaurant Ceptura' and initcap(sl.localitate) = 'Ploiesti'
     )

SELECT DECODE((SELECT upper(substr(sc.nr_inmatriculare, 0, 2))
               FROM camion sc JOIN istoric_camioane_conduse sic ON(sc.id_camion = sic.id_camion)
                              JOIN angajat sa ON(sic.id_angajat = sa.id_angajat)
               WHERE sic.id_angajat = a.id_angajat
                    and ip.data_sosire < NVL(sic.data_sfarsit, sysdate)
                    and ip.data_sosire > NVL(sic.data_inceput, sysdate)
               ), 'PH', 'Din Prahova', 'Alta regiune'
              ) "Verifica camion din Prahova",
       a.nume "Nume angajat", a.prenume "Prenume angajat", a.salariu "Salariu",
       p.nume "Nume popas", initcap(p.tip_popas) "Tip popas",
       to_char(ip.data_sosire, 'hh24:mi') "Ora sosire",
       substr(numtodsinterval((ip.data_plecare - ip.data_sosire), 'DAY'), 12, 5) "Durata",
       (SELECT CASE WHEN salariu <=3000 THEN salariu * 0.005
                    WHEN salariu <=4500 THEN salariu * 0.01
                    WHEN salariu > 4500 THEN salariu * 0.015
               END
        FROM angajat ssa
        WHERE a.id_angajat = ssa.id_angajat
       ) || 'lei' "bani cheltuiti",
       'Jud: ' || NVL(l.judet, '-') || ' Loc: ' || NVL(l.localitate, '-') ||
       ' Str. ' || NVL(l.strada, '-') || ' Nr. ' || NVL(to_char(l.nr), '-') "Locatie popas"
FROM istoric_popasuri ip JOIN angajat a ON(ip.id_angajat = a.id_angajat)
                         JOIN popas p ON(ip.id_popas = p.id_popas)
                         JOIN locatie l ON(p.id_locatie = l.id_locatie)
WHERE a.tip_angajat = 'SOFER'
    and to_char(data_sosire, 'dd-mm-yyyy') = (SELECT * FROM psp)
ORDER BY a.nume, a.prenume;

-- 2

/* Sa se afiseze numele, prenumele, ce salariu isi doreste, cat de bine este
 * platit, vechimea la locul de munca curent, la ce firma lucreaza, si ce
 * depozit pazesc toti paznicii care lucreaza in depozite din localitatea in care
 * se afla cel mai vizitat popas de soferii de tir si doar pentru paznicii pentru
 * care a intrat sub paza lor in depozit cel putin un transport de marfa.
 * Daca un paznic are salariul mai mic decat media salariul din firma in care
 * lucreaza, atunci el isi doreste o marire de salariu cu 200 lei, in caz contra
 * doresc o marire de 100 lei. Consideram ca un paznic este bine platit daca are
 * un salariu mai mare decat 3000 lei inclusiv. Suma de 3000lei reprezinta media
 * salariilor paznicilor din Romania inidiferent de locatia pazita(nu intra doar
 * depozitele din gestiunea acestei baze de date). Sa se odroneze descrescator
 * dupa salariu si in caz de egalitate crescator dupa nume si prenume. */

WITH
    avgs AS -- media salariilor paznicilor per firma
    (SELECT round(avg(salariu)) salariu, id_firma
     FROM angajat
     WHERE tip_angajat = 'PAZNIC'
     GROUP BY id_firma
     ),

    cm_vizitat_popas AS -- id-ul celui mai vizitat popas
    (
     SELECT id_popas popas
     FROM istoric_popasuri
     GROUP BY id_popas
     HAVING count(id_popas) = (SELECT max(count(id_popas))
                               FROM istoric_popasuri
                               GROUP BY id_popas
                               )
     ),

    loc_cm_vizitat_popas AS -- localitatea in care se afla cel mai vizitat popas
    (SELECT sl.localitate localitate
     FROM locatie sl JOIN popas sp ON (sl.id_locatie = sp.id_locatie),
          cm_vizitat_popas cmvp
     WHERE sp.id_popas = cmvp.popas
     )


SELECT a.nume "Nume paznic", a.prenume "Prenume paznic",
        CASE WHEN a.salariu < avgs.salariu THEN a.salariu + 200
             ELSE a.salariu + 100
        END "Salariu dorit",
        DECODE((a.salariu-3000)-abs(a.salariu-3000)
         , 0, 'bine platit', 'prost platit') "Cat de bine este platit",
        concat(substr(numtodsinterval((sysdate - a.data_angajare), 'DAY'), 8, 3) ||' zile ',
            substr(numtodsinterval((sysdate - a.data_angajare), 'DAY'), 12, 5)) "Vechime angajat",
        f.nume "Nume firma",
        'Jud: ' || NVL(l.judet, '-') || ' Loc: ' || NVL(l.localitate, '-') ||
        ' Str. ' || NVL(l.strada, '-') || ' Nr. ' || NVL(to_char(l.nr), '-') "Locatie depozit repartizat",

        ( -- nr de colegi ai unui angajat
         SELECT DECODE(count(id_echipa_paza)-1, 0, 'Nu are colegi', 1,
                 to_char(count(id_echipa_paza)-1) || ' coleg',
                 to_char(count(id_echipa_paza)-1) || ' colegi')
         FROM angajat
         WHERE id_echipa_paza = a.id_echipa_paza
         GROUP BY id_echipa_paza
         ) "Nr. Colegi"

FROM echipa_paza ep JOIN firma f ON (ep.id_firma = f.id_firma)
                    JOIN angajat a ON (ep.id_echipa_paza = a.id_echipa_paza)
                    JOIN depozit d ON (ep.id_echipa_paza = d.id_echipa_paza)
                    JOIN locatie l ON (d.id_locatie = l.id_locatie)
                    JOIN avgs ON (avgs.id_firma = f.id_firma),
    loc_cm_vizitat_popas cmvp

WHERE a.tip_angajat = 'PAZNIC'
    and l.localitate in cmvp.localitate
    and ( -- cate transporturi de marfa au intrat in depozit sub paza fiecarui angajat
         SELECT count(depozit_destinatie)
         FROM transport
         WHERE depozit_destinatie = d.id_depozit
            and data_plecare > a.data_angajare
         GROUP BY depozit_destinatie
         ) >= 1
ORDER BY a.salariu desc, a.nume, a.prenume;

-- 3

/* Sa se afiseze data\&ora de plecare, numele si prenumele soferului, ce salariu
 * are, cat de bine este platit fata de media salariului din Ro care este de
 * 3500lei, ce marca de camion a condus, nr de inmatriculare al camionului,
 * sa se specifice in ce judet a fost inmatriculat camionul,
 * iar pentru depozitul de plecare si destinatie sa se precizeze ce firma le detine
 * si in ce zona se afla, pentru fiecare transport al celor mai bine platiti
 * soferi din firmele unde sunt angajati, sa se afiseze doar transporturile
 * in care soferii au folosit acelasi camion ca cel actual pe care il conduc si
 * doar transporturile realizate incepand cu data in care a fost angajat ultimul
 * sofer de la toate firmele de transport.
 * Sa se ordoneze detaliile anterioare despre transport in ordine crescatoare
 * dupa data de plecare din primul depozit */

WITH ac AS -- informatii despre cei mai bine platiti soferi din firma unde sunt angajati si camionul curent
    (SELECT c.id_camion, c.marca, c.nr_inmatriculare, a.id_angajat, a.nume,
            a.prenume, a.salariu, a.id_firma
     FROM angajat a JOIN istoric_camioane_conduse ic ON (a.id_angajat = ic.id_angajat)
                    JOIN camion c ON(c.id_camion = ic.id_camion)
     WHERE (a.salariu, a.id_firma) in (SELECT max(salariu), id_firma -- obtine salariul mare din firma
                                       FROM angajat
                                       WHERE tip_angajat = 'SOFER'
                                       GROUP BY tip_angajat, id_firma
                                       )
        and ic.data_sfarsit is null
     )

SELECT
     to_char(t.data_plecare, 'dd-mm-yyyy') "Data plecare",
     to_char(t.data_plecare, 'hh24:mi') "Ora",-- data plecare transport
     ac.nume "Nume sofer", ac.prenume "Prenume", -- cine a condus acest transport
     ac.salariu "Salariu sofer", -- ce salariu are
     DECODE((ac.salariu-3500)-abs(ac.salariu-3500)
     , 0, 'bine platit', 'prost platit') "Cat de bine este platit",

     ac.marca "Camion",
     ac.nr_inmatriculare "Nr inmatriculare",
     CASE WHEN substr(ac.nr_inmatriculare, 0, 2)= 'MM' THEN 'Maramures'
          WHEN substr(ac.nr_inmatriculare, 0, 2)= 'IS' THEN 'Iasi'
          WHEN substr(ac.nr_inmatriculare, 0, 2)= 'CT' THEN 'Constanta'
          WHEN substr(ac.nr_inmatriculare, 0, 1)= 'B' THEN 'Bucuresti'
          ELSE 'Necunoscut'
     END "Inmatriculat in judetul",

    (SELECT sf.nume -- cine detine depozitul de plecare
     FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
     WHERE sd.id_depozit = t.depozit_plecare) "Proprietar depozit plecare",
    (SELECT 'Loc: ' || NVL(sl.localitate, '-') || ' Str. ' -- unde se afla depozitul
        || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-')
     FROM depozit sd JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
     WHERE sd.id_depozit = t.depozit_plecare) "Locatie depozit plecare",

    (SELECT sf.nume -- cine detine depozitul de destinatie
     FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
     WHERE sd.id_depozit = t.depozit_destinatie) "Proprietar depozit destinatie",
    (SELECT 'Loc: ' || NVL(sl.localitate, '-') || ' Str. ' -- unde se afla depozitul
        || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-')
     FROM depozit sd JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
     WHERE sd.id_depozit = t.depozit_destinatie) "Locatie depozit destinatie"

FROM transport t JOIN ac ON(t.id_camion = ac.id_camion)

WHERE t.data_plecare > (SELECT max(data_angajare)
                        FROM angajat
                        WHERE tip_angajat = 'SOFER')
ORDER BY t.data_plecare;

-- 4

/* Sa se afiseze pentru transporturile realizate dupa prima zi de luni de la data
 * primei angajari a unui sofer in firma care detine camionul care a realizat
 * transportul, numele marfii, cantitatea de marfa, tipul marfii transportate
 * (putem avea alimente, imbracaminte, incaltaminte), marca, nr de inmatriculare
 * si judetul in care a fost inmatriculat camionul cu care a fost realizat
 * transportul, data si ora la care a plecat camionul din depozitul de plecare,
 * ce firma detine depozitul de plecare, in ce locatie se afla depozitul de
 * plecare, anaog pentru cel de destinatie. Sa se ordoneze crescator dupa data
 * si ora de plecare, si descrescator dupa cantitatea de marfa transportata */

WITH depozit_plecare AS
    (SELECT id_depozit, sf.nume detinator, 'Loc: ' || NVL(sl.localitate, '-')
        || ' Str. ' || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-') locatie
    FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
                  JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
    ),
    depozit_destinatie AS
    (SELECT id_depozit, sf.nume detinator, 'Loc: ' || NVL(sl.localitate, '-')
        || ' Str. ' || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-') locatie
     FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
                   JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
     )

SELECT lm.nume "Marfa", lm.cantitate "Cantitate marfa",
       DECODE(lower(lm.nume), 'carne miel', 'alimente', 'carne porc', 'alimente',
              'carne pui', 'alimente', 'lapte', 'alimente', 'rosii', 'alimente',
              'ardei', 'alimente', 'tricouri', 'imbracaminte', 'hanorace', 'imbracaminte',
              'rochii', 'imbracaminte', 'fuste', 'imbracaminte', 'blugi', 'imbracaminte',
              'pantofi', 'incaltaminte', 'necunoscut') "Tip aliment",
       c.marca "Marca camion", c.nr_inmatriculare "Nr. inmatriculare",
       CASE WHEN substr(c.nr_inmatriculare, 0, 2)= 'MM' THEN 'Maramures'
            WHEN substr(c.nr_inmatriculare, 0, 2)= 'IS' THEN 'Iasi'
            WHEN substr(c.nr_inmatriculare, 0, 2)= 'CT' THEN 'Constanta'
            WHEN substr(c.nr_inmatriculare, 0, 1)= 'B' THEN 'Bucuresti'
            ELSE 'Necunoscut'
       END "Inmatriculat in judetul",
       to_char(t.data_plecare, 'dd-mm-yyyy hh24:mi') "Data si ora plecare",
       round(months_between(sysdate, t.data_plecare)) "Nr. luni de la transport",
       dp.detinator "Detinator depozit plecare", dp.locatie "Locatie depozit plecare",
       dd.detinator "Detinator depozit destinatie", dd.locatie "Locatie depozit destinatie"

FROM transport t JOIN camion c ON(t.id_camion = c.id_camion)
                 JOIN firma f ON(c.id_firma = f.id_firma)
                 JOIN inventar_transport it ON(t.id_transport = it.id_transport)
                 JOIN lot_marfa lm ON(it.id_lot_marfa = lm.id_lot_marfa)
                 JOIN depozit_plecare dp ON(dp.id_depozit = t.depozit_plecare)
                 JOIN depozit_destinatie dd ON(dd.id_depozit = t.depozit_destinatie)


WHERE data_plecare >= next_day((SELECT max(sa.data_angajare)
                                FROM angajat sa JOIN istoric_camioane_conduse sic ON(sa.id_angajat = sic.id_angajat)
                                                  JOIN camion sc ON(sic.id_camion = sc.id_camion)
                                WHERE sa.tip_angajat = 'SOFER' and sa.id_firma = f.id_firma
                                GROUP BY tip_angajat
                                ), 'MONDAY')

ORDER BY t.data_plecare, lm.cantitate desc;

-- 5

/* Pentru toti soferii care lucreaza la una din firmele Road Logistics, Transibo
 * sau Lextom Trans Asd si care detin cel putin 2 categorii de permis sa se
 * afiseze numele\&prenumele soferului, cat de experimentat e(<1an e INCEPATOR,
 * <700 zile AVANSAT si in rest PROFESIONIST), cat de bine este platit(se considera
 * ca un sofer este bine platit daca are un salariu>=4000lei) marca camionului
 * si nr de inmatriculare al camionului pe care l-a condus in acel transport,
 * data in care a plecat camionul din depozit cu marfa, detinatorul depozitului
 * de plecare si destinatie, si analog pentru cel de destinatie */

WITH soferi AS -- soferii care detin cel putin 2 categorii de permis auto si care
    -- lucreaza la una din firmele: Road Logistics, Transibo, Lextom Trans Asd
    (SELECT a.id_angajat id_sofer
     FROM angajat a JOIN permis p ON (a.id_angajat = p.id_angajat)
                    JOIN firma f ON (f.id_firma = a.id_firma)
     WHERE initcap(f.nume) = 'Road Logistics' or initcap(f.nume) = 'Transibo'
        or initcap(f.nume) = 'Lextom Trans Asd'
     GROUP BY a.id_angajat
     HAVING count(p.id_angajat) >= 2
     )

SELECT a.nume "Nume sofer", a.prenume "Prenume",
       CASE WHEN to_number(substr(numtodsinterval((sysdate - a.data_angajare), 'DAY'), 2, 9)) <= 356 THEN 'INCEPATOR'
            WHEN to_number(substr(numtodsinterval((sysdate - a.data_angajare), 'DAY'), 2, 9)) <= 700 THEN 'AVANSAT'
            ELSE 'PROFESIONIST'
       END "Experienta",
       DECODE((a.salariu-4000)-abs(a.salariu-4000), 0, 'bine platit', 'prost platit') "Cat de bine este platit",
       c.marca "Marca camion", c.nr_inmatriculare "Nr. inmatriculare",
       (SELECT sf.nume -- cine detine depozitul de plecare
        FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
        WHERE sd.id_depozit = t.depozit_plecare) "Proprietar depozit plecare",
       (SELECT 'Loc: ' || NVL(sl.localitate, '-') || ' Str. ' -- unde se afla depozitul
                || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-')
        FROM depozit sd JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
        WHERE sd.id_depozit = t.depozit_plecare) "Locatie depozit plecare",

       (SELECT sf.nume -- cine detine depozitul de destinatie
        FROM firma sf JOIN depozit sd ON (sf.id_firma = sd.id_firma)
        WHERE sd.id_depozit = t.depozit_destinatie) "Proprietar depozit destinatie",
       (SELECT 'Loc: ' || NVL(sl.localitate, '-') || ' Str. ' -- unde se afla depozitul
                || NVL(sl.strada, '-') || ' Nr. ' || NVL(to_char(sl.nr), '-')
        FROM depozit sd JOIN locatie sl ON (sd.id_locatie = sl.id_locatie)
        WHERE sd.id_depozit = t.depozit_destinatie) "Locatie depozit destinatie"

FROM angajat a JOIN istoric_camioane_conduse ic ON(a.id_angajat = ic.id_angajat)
               JOIN camion c ON(ic.id_camion = c.id_camion)
               JOIN transport t ON(c.id_camion = t.id_camion)
WHERE a.id_angajat in (SELECT * FROM soferi)
    and ic.data_sfarsit is null;
\end{lstlisting}

\newpage
\section{Operatii de actualizare si \\suprimare a datelor - ex12}
\begin{lstlisting}[language=SQL]
/* 12. Implementarea a 3 operatii de actualizare sau suprimare a datelor
 * utilizand subcereri. */

/* pentru inceputul verii fiecare firma de paza ofera o marire de salariu cu 75lei
 * angajatilor cu cel mai mic salariu din firma */
UPDATE ANGAJAT
SET salariu = salariu + 75
WHERE (salariu, id_firma) in (SELECT min(salariu), id_firma
                              FROM ANGAJAT
                              WHERE tip_angajat = 'PAZNIC'
                              GROUP BY id_firma
                              );

/* pe data de 2 aprilie 2021 a intrat in inventarierea unui depozit din
 * jud Tulcea loc Tulcea str. Unirii nr. 213 un lot de marfa
 * de carne de miel a carei cantitate a fost introdusa gresit in baza de date,
 * in loc 400 de kg de carne a fost introdusa valoarea 100 */
UPDATE LOT_MARFA
SET cantitate = 400
WHERE lower(nume) = 'carne miel'
    AND id_lot_marfa IN
        (SELECT id_lot_marfa
         FROM LOCATIE l JOIN DEPOZIT d ON(l.id_locatie = d.id_locatie)
                        JOIN INVENTAR_DEPOZIT id ON(d.id_depozit = id.id_depozit)
         WHERE initcap(localitate) = 'Tulcea' AND initcap(strada)='Unirii' AND nr = 213
                AND to_char(id.data_sosire, 'dd-mm-yyyy') = '02-04-2021'
         );

/* stregem din baza de date popasurile care nu au fost vizitate pana acum de
 * niciun sofer de tir */
DELETE FROM POPAS
WHERE id_popas not in (select id_popas FROM ISTORIC_POPASURI);

commit; -- salvam modificarile facute
\end{lstlisting}

\newpage
\section{Cereri outer-join + division - ex16}
\begin{lstlisting}[language=SQL]
/* 16. Formulati in limbaj natural si implementati in SQL: o cerere ce utilizeaza
 * operatia outer-join pe minimum 4 tabele si doua cereri ce utlizeaza operatia
 * division. */

-- outer join - versiunea 1 va fi optimizata la cerinta 17

/* Pentru fiecare camion sa se afiseze marca, nr. de inmatriculare, numele firmei,
 * de ce soferi a fost condus(pentru fiecare sofer sa se precizeze numele,
 * prenumele si salariul, in cazul in care un camion nu a fost condus de un
 * sofer sa se inlocuiasca aceste coloane cu '-'), dar si data de plecare pentru
 * fiecare transport realizat de sofer cu acest camion. Daca unui angajat i-a
 * fost alocat un camion dar nu a realizat niciun transport in loc de data sa
 * fie afisat mesajul 'nu a realizat transporturi'. Sa se afiseze informatiile
 * despre angajatii doar daca sunt soferi, au fost angajati inainte de data de
 * 13 sept 2020 si detin cel putin un permis auto, in cazul in care un camion a
 * fost condus de un sofer care nu indeplineste aceste cerinte se vor inlocui
 * coloanele cu informatii despre angajat cu '-'.
 * Sa se excluda camioanele de marca IVECO. */

WITH ang AS -- soferii angajati inainte de 13 sept 2020 care detin cel mult 2 permise auto
    (SELECT p.id_angajat, a.nume, a.prenume, a.salariu
     FROM angajat a JOIN permis p ON (a.id_angajat = p.id_angajat)
     WHERE a.tip_angajat = 'SOFER'
        and to_char(a.data_angajare, 'dd-mm-yyyy') < '13-9-2020'
     GROUP BY p.id_angajat, a.nume, a.prenume, a.salariu
     HAVING count(p.id_angajat) >= 1  -- care detine cel putin 1 permis
     )

SELECT c.marca, c.nr_inmatriculare, f.nume,
       NVL(a.nume, '-') "Nume sofer", NVL(a.prenume, '-') "Prenume sofer",
       NVL(to_char(a.salariu), '-') "Salariu sofer",
       NVL(to_char(t.data_plecare, 'dd-mm-yyyy'), 'nu a realizat transporturi') "Data transport"
FROM camion c JOIN firma f ON (c.id_firma = f.id_firma)
              FULL OUTER JOIN istoric_camioane_conduse icc ON (c.id_camion = icc.id_camion)
              FULL OUTER JOIN ang a ON (icc.id_angajat = a.id_angajat)
              FULL OUTER JOIN transport t ON (c.id_camion = t.id_camion)
WHERE
    upper(c.marca) != 'IVECO' and
    f.tip_firma = 'TRANSPORT' and
    ((icc.data_inceput < t.data_plecare and t.data_plecare <= NVL(icc.data_sfarsit, sysdate)
     )   or t.data_plecare is null
    );

-- division

-- 1

/* Sa se afiseze pentru fiecare sofer numele, prenumele, salariul si nr. de
 * permise auto detinute, care au condus cel mult aceleasi marci de camioane
 * precum soferul Ion Vasile. Sa se ordoneze descrescator dupa nr. de permise
 * detinute, descrescator dupa salariu in caz de egalitate si in final crescator
 * dupa nume\&prenume */

WITH marca_camion_ang AS -- marcile de camioane conduse de angajatul Ion Vasile
       (select c.marca
        from camion c join istoric_camioane_conduse icc on (c.id_camion = icc.id_camion)
                   join angajat a on (icc.id_angajat = a.id_angajat)
        where initcap(a.nume) = 'Ion' and initcap(a.prenume) = 'Vasile'
        ),

    division_ang AS -- id-urile angajatilor care conduc cel mult aceleasi marci de camioane precum ang Ion Vasile (inclusiv el)
       (select icc.id_angajat id_angajat
        from camion c join istoric_camioane_conduse icc on (c.id_camion = icc.id_camion)
        where c.marca in
                    (SELECT *
                     FROM marca_camion_ang
                     )
        group by icc.id_angajat
        having count(*) <=
                    (SELECT count(*)
                     FROM marca_camion_ang
                     )

        MINUS

        select icc.id_angajat
        from camion c join istoric_camioane_conduse icc on (c.id_camion = icc.id_camion)
        where c.marca not in (SELECT *
                              FROM marca_camion_ang
                              )
        )

SELECT a.nume, a.prenume, a.salariu, count(*) "Nr. permise auto"
FROM angajat a JOIN division_ang da ON (a.id_angajat = da.id_angajat)
               JOIN permis p ON (a.id_angajat = p.id_angajat)
WHERE not (initcap(a.nume) = 'Ion' and initcap(a.prenume) = 'Vasile')
GROUP BY a.nume, a.prenume, a.salariu
ORDER BY 4 desc, 3 desc, 1, 2;

-- 2

/* Sa se afiseze id-urile tuturor popasurilor vizitate de toti soiferii cu
 * salariul de 5000lei folosind implementarea DIVISION-ului cu dublu NOT EXISTS */

SELECT DISTINCT id_popas
FROM istoric_popasuri ip
WHERE NOT EXISTS
    (SELECT 1
     FROM angajat a
     WHERE tip_angajat = 'SOFER' and salariu = 5000
     AND NOT EXISTS
        (SELECT 'x'
         FROM istoric_popasuri sip
         WHERE a.id_angajat = sip.id_angajat
            and sip.id_popas = ip.id_popas
         )
     );

-- 3

/* Sa se afiseze pentru totate popasurile vizitate de toti soferii cu salariul
 * de 5000 lei tipul popasului, numele sau si locatia unde se afla. Sa se
 * utilizeze alta metoda de implementare fata de punctul anterior. */

WITH sofer AS -- soferi cu salariu de 5000 lei
    (SELECT id_angajat
     FROM angajat
     WHERE tip_angajat = 'SOFER' and salariu = 5000
     ),

    pop AS -- popasurile vizitate de toti soferii cu salariu de 5000 lei
    (SELECT id_popas id_popas
     FROM istoric_popasuri
     WHERE id_angajat IN (SELECT *
                          FROM sofer
                          )
     GROUP BY id_popas
     HAVING count(id_angajat) = (SELECT count(*)
                                 FROM sofer
                                 )
     )

SELECT p.tip_popas "Tip popas", p.nume "Nume popas",
       'Jud: ' || NVL(l.judet, '-') || ' Loc: ' || NVL(l.localitate, '-') ||
       ' Str. ' || NVL(l.strada, '-') || ' Nr. ' || NVL(to_char(l.nr), '-') "Locatie popas"
FROM popas p JOIN pop ON (p.id_popas = pop.id_popas)
             JOIN locatie l ON (p.id_locatie = l.id_locatie);
\end{lstlisting}
\newpage

\section{Dovezi rulare corecta a codului SQL}
\includegraphics[width=\textwidth]{tabele.png}
\label{tabele_create}
\centering Tabele create

\includegraphics[width=\textwidth]{date_tabel_ang.png}
\label{date_tabel_ang}
\centering Date salvate in tabelul ANGAJAT

\includegraphics[width=\textwidth]{date_tabel_trans.png}
\label{date_tabel_trans}
\centering Date salvate in tabelul TRANSPORT

\includegraphics[width=\textwidth]{date_tabel_ist_pop.png}
\label{date_tabel_ist_pop}
\centering Date salvate in tabelul ISTORIC\_POPASURI

\includegraphics[width=\textwidth]{ex11_1.png}
\label{Ex11 1}
\centering Ex. 11 - 1

\includegraphics[width=\textwidth]{ex11_2.png}
\label{Ex11 2}
\centering Ex. 11 - 2

\includegraphics[width=\textwidth]{ex11_3_1.png}
\label{Ex11 3.1}
\centering Ex. 11 - 3.1

\includegraphics[width=\textwidth]{ex11_3_2.png}
\label{Ex11 3.2}
\centering Ex. 11 - 3.2

\includegraphics[width=\textwidth]{ex11_4_1.png}
\label{Ex11 4.1}
\centering Ex. 11 - 4.1

\includegraphics[width=\textwidth]{ex11_4_2.png}
\label{Ex11 4.2}
\centering Ex. 11 - 4.2

\includegraphics[width=\textwidth]{ex11_5.png}
\label{Ex11 5}
\centering Ex. 11 - 5

\includegraphics[width=\textwidth]{ex12.png}
\label{Ex12}
\centering Ex. 12 - 2 updateuri + 1 delete urmate de commit

\includegraphics[width=\textwidth]{outer_join_1.png}
\label{Ex16 1-1}
\centering Ex. 16 - 1v1 outer join

\includegraphics[width=\textwidth]{outer_join_2.png}
\label{Ex16 1-2}
\centering Ex. 17 - 1v2 outer join versiune optimizată

\includegraphics[width=\textwidth]{division_1.png}
\label{Ex16 2-1}
\centering Ex. 16 - 2-1 division

\includegraphics[width=\textwidth]{division_2.png}
\label{Ex16 2-2}
\centering Ex. 16 - 2-2 division

\includegraphics[width=\textwidth]{division_3.png}
\label{Ex16 2-3}
\centering Ex. 16 - 2-3 division

\end{document}
